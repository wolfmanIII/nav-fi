{% extends 'base.html.twig' %}

{% block title %}Nav-Fi - Financial Core User Guide{% endblock %}

{% block pageContent %}
    <div class="min-h-[80vh] space-y-8">
        
        {# Hero Header #}
        <div class="relative rounded-2xl border border-amber-500/30 bg-gradient-to-r from-slate-900 via-slate-800 to-amber-900 shadow-lg mb-8 overflow-hidden">
            <div class="absolute inset-0 opacity-30 mix-blend-screen pointer-events-none"
                 style="background: radial-gradient(circle at 20% 20%, rgba(251,191,36,0.25), transparent 35%), radial-gradient(circle at 80% 30%, rgba(245,158,11,0.25), transparent 35%);">
            </div>
            <div class="relative p-8">
                <div class="flex items-center gap-4 mb-4">
                    <div class="p-3 rounded-lg bg-amber-500/10 border border-amber-400/40 w-14 h-14 flex items-center justify-center normal-case">
                        <span class="text-2xl font-bold text-amber-400 font-orbitron">Cr</span>
                    </div>
                    <div>
                        <p class="uppercase text-[10px] tracking-[0.3em] text-amber-300/70 font-bold font-orbitron mb-1">Complete Reference</p>
                        <h1 class="text-3xl font-bold text-amber-100 leading-tight font-orbitron uppercase">Financial Core User Guide</h1>
                        <p class="text-sm text-amber-100/60 font-rajdhani tracking-widest uppercase mt-1">Master the credit flow: time travel, organization management, and automated ledgers.</p>
                    </div>
                </div>
            </div>
        </div>

        {# Table of Contents #}
        <div class="rounded-xl bg-slate-900/60 border border-slate-800 p-6 mb-8">
            <h2 class="text-lg font-bold text-cyan-100 font-orbitron uppercase mb-4 flex items-center gap-2">
                <span class="text-cyan-400">///</span> Table of Contents
            </h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
                <a href="#core-concepts" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>1. Core Concepts & "The Asset"</span>
                </a>
                <a href="#time-cursor" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>2. Session Date as Time Cursor</span>
                </a>
                <a href="#modules" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>3. Module Deep Dive</span>
                </a>
                <a href="#workflows" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>4. Practical Workflows</span>
                </a>
            </div>
        </div>

        {# 1. CORE CONCEPTS #}
        <section id="core-concepts" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-cyan-950/10 border border-slate-800 p-8">
                <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2 font-orbitron">
                    <span class="text-cyan-400">01 ///</span> Core Concepts & The Entity of "The Asset"
                </h2>
                
                <div class="space-y-6">
                    <div class="prose prose-invert prose-sm max-w-none">
                        <p class="text-slate-300 leading-relaxed mb-4">
                            Nav-Fi is not just a spreadsheet; it is a relational financial engine. To function, it requires a central anchor point for all data.
                        </p>
                        
                        <div class="grid lg:grid-cols-2 gap-8 mt-6">
                            {# The Asset Anchor #}
                            <div class="rounded-lg bg-cyan-950/20 border border-cyan-500/20 p-5">
                                <h3 class="text-lg font-bold text-cyan-100 mb-3 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-cyan-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20h20"/><path d="M5 20v-8a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8"/><path d="M12 10V4"/></svg>
                                    The "Asset" is Mandatory
                                </h3>
                                <p class="text-slate-400 text-sm mb-4">
                                    In Nav-Fi, the <strong>Asset</strong> is the fundamental accounting unit. All Incomes, Costs, Mortgages, and Budgets <em>must</em> belong to an Asset. 
                                </p>
                                <div class="alert alert-info bg-cyan-950/30 border-cyan-500/30 text-cyan-200 text-xs">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    <span>
                                        <strong>For Players:</strong> An Asset entity is <strong>REQUIRED</strong>. You cannot track player finances without it.<br/>
                                        <strong>For NPCs/Adversaries:</strong> Optional. You can create fully detailed assets with fits/crew for combat, but you can skip the <em>Financial Core</em> tracking unless you specifically want to simulate their economy.
                                    </span>
                                </div>
                            </div>

                            {# Logic for No Asset #}
                            <div class="rounded-lg bg-emerald-950/20 border border-emerald-500/20 p-5">
                                <h3 class="text-lg font-bold text-emerald-100 mb-3 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                     No Starship? Use a "Team"
                                 </h3>
                                 <p class="text-slate-400 text-sm mb-3">
                                     Running a mercenary campaign? Or a ground-based trade company? The "Asset" entity is flexible.
                                 </p>
                                 <ul class="text-slate-300 text-sm space-y-2 list-disc pl-4">
                                     <li>Create an Asset named <strong>"Alpha Squad"</strong> or <strong>"Trade Corp"</strong>.</li>
                                     <li>Leave the <strong>Components/Fit</strong> empty (it's optional!).</li>
                                     <li>Use this abstract "Asset" to track all your team's credits, contracts, and salary costs.</li>
                                 </ul>
                                 <p class="text-xs text-emerald-400/80 mt-3 italic">
                                     The Financial Core works perfectly for any organization by treating it as an "Asset" container.
                                 </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {# 2. TIME CURSOR #}
        <section id="time-cursor" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-amber-950/10 border border-amber-500/30 p-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-amber-400">02 ///</span> The Time Cursor: Historical & Future Analysis
                </h2>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2 space-y-4">
                        <p class="text-slate-300 text-sm leading-relaxed">
                            The <strong>Mission Session Date</strong> is not just a "current date" field. it acts as a <strong class="text-amber-300">Time Cursor</strong> for the entire financial simulation. 
                            By moving this date, you are effectively moving the "Now" point of your campaign's financial reality.
                        </p>
                        
                        <div class="space-y-4 mt-6">
                            <div class="flex gap-4 p-4 rounded-lg bg-slate-950/50 border border-slate-800">
                                <div class="mt-1 flex-shrink-0">
                                    <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-600 flex items-center justify-center text-slate-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/></svg>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-slate-200 font-bold mb-1">Looking into the Past</h4>
                                    <p class="text-slate-400 text-xs">
                                        If you set the Session Date to a past year, the <strong>Ledger</strong> and <strong>Budget</strong> will recalculate to show you the state of finances <em>at that exact moment</em>. 
                                        Future transactions (relative to that past date) become "Pending" again. This allows accurate historical auditing.
                                    </p>
                                </div>
                            </div>

                             <div class="flex gap-4 p-4 rounded-lg bg-slate-950/50 border border-slate-800">
                                <div class="mt-1 flex-shrink-0">
                                    <div class="w-8 h-8 rounded-full bg-amber-500/20 border border-amber-500/50 flex items-center justify-center text-amber-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 12"/></svg>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-amber-200 font-bold mb-1">Projecting the Future</h4>
                                    <p class="text-slate-400 text-xs">
                                        Advance the Session Date into the future to see what happens when "Pending" transactions hit. 
                                        Will the mortgage payment clear? Will that big contract payout arrive in time? 
                                        <strong class="text-amber-300">The Ledger simulates the future</strong> based on the data you've entered.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="rounded-lg bg-amber-950/20 border border-amber-500/20 p-5">
                            <h3 class="text-sm font-bold text-amber-100 uppercase tracking-wider mb-2">Automated Ledger Logic</h3>
                            <ul class="space-y-3 text-xs text-slate-300">
                                <li class="flex gap-2">
                                    <span class="text-emerald-400 font-mono">1.</span>
                                    <span><strong>Effective Date:</strong> If a Transaction Date <= Session Date, it is <strong>POSTED</strong> (Green) and affects the balance.</span>
                                </li>
                                <li class="flex gap-2">
                                    <span class="text-amber-400 font-mono">2.</span>
                                    <span><strong>Pending Date:</strong> If a Transaction Date > Session Date, it is <strong>PENDING</strong> (Yellow) and does not yet touch the credits.</span>
                                </li>
                                <li class="flex gap-2">
                                    <span class="text-cyan-400 font-mono">3.</span>
                                    <span><strong>Auto-Correction:</strong> Moving the Session Cursor automatically flips transactions between POSTED and PENDING statuses.</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {# 3. MODULE DEEP DIVE #}
        <section id="modules" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-purple-950/10 border border-slate-800 p-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-purple-400">03 ///</span> Module Deep Dive
                </h2>

                <div class="space-y-12">
                    
                    {# INCOME #}
                    <div>
                        <h3 class="text-xl font-bold text-emerald-100 mb-4 border-b border-emerald-500/30 pb-2">
                            A. Income: Smart Transactions
                        </h3>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="prose prose-invert prose-sm">
                                <p>
                                    Income in Nav-Fi is "Smart". When you create an income record (like a Cargo Contract), the system doesn't just add a number. It analyzes your <strong>Signing Date</strong> and <strong>Payment Date</strong>.
                                </p>
                                <ul class="list-none space-y-2 pl-0">
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">Deposit Handling:</strong> If you specify a deposit (e.g., 10% on signing), the system creates an immediate transaction for that amount on the <em>Signing Date</em>.
                                    </li>
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">Final Balance:</strong> The remaining amount waits in "Pending" status until the <em>Payment Date</em> arrives.
                                    </li>
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">Bonus Logic:</strong> Crushed the deadline? Add a bonus. It gets added to the Final Balance transaction automatically.
                                    </li>
                                </ul>
                            </div>
                            <div class="bg-slate-950 rounded-lg border border-emerald-500/10 p-4">
                                <div class="text-xs font-mono text-emerald-500/50 mb-2 uppercase">Example Flow</div>
                                <div class="space-y-2 text-xs">
                                    <div class="flex justify-between p-2 bg-slate-900 rounded border border-emerald-500/20">
                                        <span class="text-slate-300">Sign Contract</span>
                                        <span class="text-emerald-400">+10,000 Cr (Deposit)</span>
                                    </div>
                                    <div class="flex justify-center text-slate-600">↓ Time Passes ↓</div>
                                    <div class="flex justify-between p-2 bg-slate-900 rounded border border-emerald-500/20">
                                        <span class="text-slate-300">Deliver Goods</span>
                                        <span class="text-emerald-400">+90,000 Cr (Balance)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {# COSTS #}
                    <div>
                        <h3 class="text-xl font-bold text-amber-100 mb-4 border-b border-amber-500/30 pb-2">
                            B. Costs: Granular Tracking
                        </h3>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div class="prose prose-invert prose-sm">
                                <p>
                                    Costs are the heartbeat of the simulation. Every credit spent is categorized and timestamped.
                                </p>
                                <ul class="list-none space-y-2 pl-0">
                                    <li class="pl-4 border-l-2 border-amber-500/30">
                                        <strong class="text-amber-300">Categories:</strong> Fuel, Life Support, Maintenance, Salaries, Berthing. Consistent use of these categories powers the Annual Budget analysis.
                                    </li>
                                    <li class="pl-4 border-l-2 border-amber-500/30">
                                        <strong class="text-amber-300">Legal Context:</strong> You can tag costs with a "Local Law" or Jurisdiction. This is vital for campaigns where compliance matters (or where bribes need to be tracked casually).
                                    </li>
                                    <li class="pl-4 border-l-2 border-amber-500/30">
                                        <strong class="text-amber-300">Detail Items:</strong> A single "Cost" record (e.g., "Starport Resupply") can have multiple line items (Fuel x50 tons, Life Support x2 weeks), creating a detailed manifest.
                                    </li>
                                </ul>
                            </div>
                             <div class="bg-slate-950 rounded-lg border border-amber-500/10 p-4">
                                <div class="text-xs font-mono text-amber-500/50 mb-2 uppercase">Budget Impact</div>
                                <p class="text-xs text-slate-400 mb-3">
                                    Costs are deducted on their <strong>Payment Date</strong>. If you defer payment (put it on a tab), set the date to the future. The debt will loom in your ledger until that day comes.
                                </p>
                            </div>
                        </div>
                    </div>

                    {# MORTGAGE #}
                    <div>
                        <h3 class="text-xl font-bold text-cyan-100 mb-4 border-b border-cyan-500/30 pb-2">
                            C. Mortgage: The Long Game
                        </h3>
                        <div class="prose prose-invert prose-sm max-w-none">
                            <p>
                                The classic Traveller burden. Nav-Fi handles the math so you can focus on the stress.
                            </p>
                            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">Standard Terms</strong>
                                    <span class="text-slate-400 text-xs">40 Years, 480 payments. The default Traveller standard.</span>
                                </div>
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">Amortization</strong>
                                    <span class="text-slate-400 text-xs">Calculates principal vs interest for every single month automatically.</span>
                                </div>
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">The Captain</strong>
                                    <span class="text-slate-400 text-xs">A mortgage <strong>requires</strong> a Captain. This links the crew hierarchy to the debt.</span>
                                </div>
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">Foreclosure Warning</strong>
                                    <span class="text-slate-400 text-xs">The Budget module highlights missed payments immediately.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        {# 4. WORKFLOWS #}
        <section id="workflows" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-cyan-950/10 border border-slate-800 p-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-cyan-400">04 ///</span> Practical Workflows
                </h2>

                <div class="grid md:grid-cols-2 gap-6">
                    {# Standard Campaign #}
                    <div class="rounded-lg bg-slate-900/60 border border-cyan-500/20 p-6">
                        <h3 class="text-lg font-bold text-cyan-100 mb-4 font-orbitron uppercase">Workflow: The Free Trader</h3>
                        <ol class="space-y-4 text-sm text-slate-300 list-decimal pl-4 marker:text-cyan-500 font-medium">
                            <li>
                                <strong>Start Session:</strong> Check the <em>Mission Date</em>. Update it to "Now".
                            </li>
                            <li>
                                <strong>Check Ledger:</strong> Look at the Asset's Ledger. Did any automated payments (Mortgage, Salaries) trigger when you advanced the date?
                            </li>
                            <li>
                                <strong>Log Activity:</strong> Add new Incomes (Contracts) and Costs (Fuel, Repairs) as they happen at the table.
                            </li>
                            <li>
                                <strong>End Session:</strong> Advance the date if time passed. The Ledger will lock "Posted" transactions.
                            </li>
                        </ol>
                    </div>

                    {# Mercenary / No Ship #}
                    <div class="rounded-lg bg-slate-900/60 border border-emerald-500/20 p-6">
                        <h3 class="text-lg font-bold text-emerald-100 mb-4 font-orbitron uppercase">Workflow: The Ground Unit (No Ship)</h3>
                        <ol class="space-y-4 text-sm text-slate-300 list-decimal pl-4 marker:text-emerald-500 font-medium">
                            <li>
                                <strong>Create "Team":</strong> Create an Asset entity named "Bravo Company". Leave fittings blank.
                            </li>
                            <li>
                                <strong>Log Logistics:</strong> Use "Costs" to track ammo, rations, and bribes. Categorize them under "Maintenance" or "Life Support".
                            </li>
                            <li>
                                <strong>Contracts:</strong> Use "Income" to log your mercenary tickets. The partial payment logic (Deposit vs Completion) is perfect for merc contracts.
                            </li>
                            <li>
                                <strong>Payroll:</strong> Standard Crew Salary functions work perfectly for your squad members.
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        {# Footer CTA #}
        <div class="rounded-xl bg-gradient-to-r from-cyan-900/20 to-amber-900/20 border border-slate-700 p-8 text-center sticky bottom-4 backdrop-blur-sm">
            <h3 class="text-xl font-bold text-white mb-3 font-orbitron">Ready to Master Your Credits?</h3>
            <div class="flex items-center justify-center gap-4">
                <a href="{{ path('app_campaign_index') }}" class="btn btn-primary btn-sm px-6 font-orbitron uppercase text-[10px] tracking-widest font-bold">
                    Create Mission
                </a>
                <a href="{{ path('app_home') }}" class="btn btn-outline btn-secondary btn-sm px-6 font-orbitron uppercase text-[10px] tracking-widest font-bold">
                    Back to Home
                </a>
            </div>
        </div>

    </div>
{% endblock %}
