{% extends 'base.html.twig' %}

{% block title %}Nav-Fi³ - Financial Core Guide{% endblock %}

{% block pageContent %}
    <div class="min-h-[80vh] space-y-8">
        
        {# Hero Header #}
        {% include 'components/_hero_header.html.twig' with {
            icon: 'icons/annual-budget.html.twig',
            theme: 'amber',
            subheader: 'Standard Operating Procedures',
            title: 'FINANCIAL CORE GUIDE',
            description: 'System manual for Credit management and ledger operations.'
        } %}

        {# Table of Contents #}
        <div class="rounded-xl bg-slate-900/60 border border-slate-800 p-6 mb-8">
            <h2 class="text-lg font-bold text-cyan-100 font-orbitron uppercase mb-4 flex items-center gap-2">
                <span class="text-cyan-400">///</span> Index
            </h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
                <a href="#core-concepts" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>1. Core Concepts & "The Asset"</span>
                </a>
                <a href="#time-cursor" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>2. Session Date as Time Cursor</span>
                </a>
                <a href="#modules" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>3. Module Deep Dive</span>
                </a>
                <a href="#salary-module" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                    <span>3b. Salaries & Payroll</span>
                </a>
                <a href="#workflows" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>4. Practical Workflows</span>
                </a>
                <a href="#cancellation" class="flex items-center gap-2 text-slate-400 hover:text-rose-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-rose-500"></span>
                    <span>5. Cancellation & VOID Tech</span>
                </a>
                <a href="#economic-nav" class="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-500"></span>
                    <span>6. Economic HUD & Navigation</span>
                </a>
            </div>
        </div>

        {# 1. CORE CONCEPTS #}
        <section id="core-concepts" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-cyan-950/10 border border-slate-800 p-8">
                <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2 font-orbitron">
                    <span class="text-cyan-400">01 ///</span> Core Concepts & The "Asset" Entity
                </h2>
                
                <div class="space-y-6">
                    <div class="prose prose-invert prose-sm max-w-none">
                        <p class="text-slate-300 leading-relaxed mb-4">
                            Nav-Fi³ is not just a spreadsheet; it's a relational financial engine. To function, it requires a central anchor point for all data.
                        </p>
                        
                        <div class="grid lg:grid-cols-2 gap-8 mt-6">
                            {# The Asset Anchor #}
                            <div class="rounded-lg bg-cyan-950/20 border border-cyan-500/20 p-5">
                                <h3 class="text-lg font-bold text-cyan-100 mb-3 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-cyan-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20h20"/><path d="M5 20v-8a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8"/><path d="M12 10V4"/></svg>
                                    The "Asset" is Mandatory
                                </h3>
                                <p class="text-slate-400 text-sm mb-4">
                                    In Nav-Fi³, the <strong>Asset</strong> is the fundamental accounting unit. All Income, Costs, Mortgages, and Budgets <em>must</em> belong to an Asset.
                                </p>
                                <div class="alert alert-info bg-cyan-950/30 border-cyan-500/30 text-cyan-200 text-xs">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    <span>
                                        <strong>For Players:</strong> An Asset entity is <strong>REQUIRED</strong>. You cannot track player finances without it.<br/>
                                        <strong>For NPCs/Adversaries:</strong> Optional. You can create detailed assets with fittings/crew for combat, but you can skip the <em>Financial Core</em> tracking unless you specifically want to simulate their economy.
                                    </span>
                                </div>
                            </div>

                            {# Logic for No Asset #}
                            <div class="rounded-lg bg-emerald-950/20 border border-emerald-500/20 p-5">
                                <h3 class="text-lg font-bold text-emerald-100 mb-3 flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                     No Ship? Use a "Team"
                                 </h3>
                                 <p class="text-slate-400 text-sm mb-3">
                                     Running a mercenary campaign? or a ground-based trade company? The "Asset" entity is flexible.
                                 </p>
                                 <ul class="text-slate-300 text-sm space-y-2 list-disc pl-4">
                                     <li>Create an Asset named <strong>"Alpha Squad"</strong> or <strong>"Trade Corp"</strong>.</li>
                                     <li>Leave <strong>Components/Fits</strong> empty (it's optional!).</li>
                                     <li>Use this abstract "Asset" to track all credits, contracts, and salary costs for your team.</li>
                                 </ul>
                                  <p class="text-xs text-emerald-400/80 mt-3 italic">
                                     The Financial Core works perfectly for any organization by treating it as an "Asset" container.
                                 </p>
                                 <div class="mt-4 p-3 bg-slate-950/60 border-l-2 border-emerald-500/50 rounded-r shadow-sm">
                                     <h4 class="text-[10px] font-bold text-emerald-300 uppercase tracking-widest mb-1">Tactical Transition</h4>
                                     <p class="text-[11px] text-slate-400 leading-relaxed">
                                         If your <strong>Team</strong> acquires a ship or base, you must create a <strong>new Asset</strong> (category: Ship/Base) to unlock technical fittings and mortgage eligibility. Reassign your crew to the new asset to maintain continuity.
                                     </p>
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {# 2. THE WALLET (FINANCIAL ACCOUNT) #}
        <section id="wallet" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-emerald-950/20 border border-emerald-500/30 p-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-emerald-400">02 ///</span> The Ship's Wallet (Financial Account)
                </h2>

                <div class="grid lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-6">
                        <p class="text-slate-300 text-sm leading-relaxed">
                            Every <strong>Asset</strong> (Ship, Base, Team) has a unique <strong class="text-emerald-300">Financial Account</strong>. 
                            Think of this as a physical "Wallet" or a dedicated bank account for that specific entity.
                        </p>
                        
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="p-4 rounded-lg bg-slate-950/50 border border-slate-800">
                                <h4 class="text-emerald-200 font-bold mb-2 flex items-center gap-2 text-xs uppercase tracking-wider">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-1"/></svg>
                                    Contents
                                </h4>
                                <ul class="text-slate-400 text-[11px] space-y-2">
                                    <li class="flex items-start gap-2">
                                        <span class="text-emerald-500">•</span>
                                        <span><strong>Credits:</strong> The liquid balance available *now*.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="text-emerald-500">•</span>
                                        <span><strong>Bank Ref:</strong> The institution providing the funds.</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="p-4 rounded-lg bg-slate-950/50 border border-slate-800">
                                <h4 class="text-emerald-200 font-bold mb-2 flex items-center gap-2 text-xs uppercase tracking-wider">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                                    Governance
                                </h4>
                                <p class="text-slate-400 text-[11px] leading-relaxed">
                                    Balances are not manual. 
                                    Only <strong>Posted Transactions</strong> move credits via the Ledger.
                                </p>
                            </div>
                            <div class="p-4 rounded-lg bg-slate-950/50 border border-slate-800">
                                <h4 class="text-cyan-200 font-bold mb-2 flex items-center gap-2 text-xs uppercase tracking-wider">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.47 20.24A10 10 0 1 1 20.24 10.47M15 15l2 2 4-4"/></svg>
                                    Tactical Page
                                </h4>
                                <p class="text-slate-400 text-[11px] leading-relaxed">
                                    Use the <strong>Financial Accounts</strong> page in the sidebar to manage accounts manually or update starting balances.
                                </p>
                            </div>
                        </div>

                        <div class="bg-slate-950/80 rounded-lg p-6 border border-slate-800">
                             <h4 class="text-slate-200 font-bold mb-4 text-xs uppercase tracking-widest text-center">Lifecycle: From Ship to Credit</h4>
                             <div class="flex items-center justify-between max-w-lg mx-auto relative cursor-default">
                                 <div class="absolute top-1/2 left-0 w-full h-px bg-slate-800 -translate-y-1/2"></div>
                                 
                                 <div class="z-10 flex flex-col items-center gap-2">
                                     <div class="bg-slate-900 border border-slate-700 p-3 rounded group hover:border-cyan-500 transition-colors">
                                         {% include 'icons/assets.html.twig' with { dim: 20 } %}
                                     </div>
                                     <span class="text-[9px] uppercase font-bold text-slate-500 group-hover:text-cyan-400 whitespace-nowrap">1. Asset</span>
                                 </div>

                                 <div class="z-10 flex flex-col items-center gap-2">
                                     <div class="bg-slate-900 border border-slate-700 p-3 rounded group hover:border-emerald-500 transition-colors">
                                         <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h11M15 15l2 2 4-4"/></svg>
                                     </div>
                                     <span class="text-[9px] uppercase font-bold text-slate-500 group-hover:text-emerald-400 whitespace-nowrap">2. Account</span>
                                 </div>

                                 <div class="z-10 flex flex-col items-center gap-2">
                                     <div class="bg-slate-900 border border-slate-700 p-3 rounded group hover:border-amber-500 transition-colors">
                                          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M5 5h14M5 19h14M2 12h20L12 2z"/></svg>
                                     </div>
                                     <span class="text-[9px] uppercase font-bold text-slate-500 group-hover:text-amber-400 whitespace-nowrap">3. Ledger</span>
                                 </div>

                                 <div class="z-10 flex flex-col items-center gap-2">
                                      <div class="bg-slate-900 border border-slate-700 p-3 rounded group hover:border-emerald-500 transition-colors">
                                          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>
                                      </div>
                                     <span class="text-[9px] uppercase font-bold text-slate-500 group-hover:text-emerald-400 whitespace-nowrap">4. Credits</span>
                                 </div>
                             </div>
                             <div class="mt-12 text-center">
                                 <p class="text-[10px] text-slate-500 italic">"Without an Account, an Asset can't have a Ledger. Without a Ledger, it can't have Credits."</p>
                             </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="rounded-lg bg-amber-950/20 border border-amber-500/20 p-5">
                            <h3 class="text-xs font-bold text-amber-100 uppercase tracking-wider mb-4">Practical: Where is the Balance?</h3>
                            
                            <div class="space-y-4 text-xs">
                                <div class="border-l-2 border-slate-800 pl-3">
                                    <p class="text-slate-200 font-bold">1. In the Asset List</p>
                                    <p class="text-slate-400 mt-1">Every asset card shows the current balance in real-time.</p>
                                </div>
                                <div class="border-l-2 border-slate-800 pl-3">
                                    <p class="text-slate-200 font-bold">2. In the Annual Budget</p>
                                    <p class="text-slate-400 mt-1">The best place to audit balances and visualize cashflow across the year.</p>
                                </div>
                                <div class="border-l-2 border-slate-800 pl-3">
                                    <p class="text-slate-200 font-bold">3. In the Asset Form</p>
                                    <p class="text-slate-400 mt-1">The Financial Account panel details the account and the linked bank.</p>
                                </div>
                            </div>

                            <div class="mt-6 pt-6 border-t border-amber-500/10">
                                <p class="text-[10px] text-amber-500/80 font-bold uppercase tracking-widest mb-2">Protocol Warning</p>
                                <p class="text-[11px] text-slate-400 italic leading-relaxed">
                                    If you delete an Asset, the system automatically removes its Financial Account and all Ledger history.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {# 2. TIME CURSOR & INTEGRITY #}
        <section id="time-cursor" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-amber-950/10 border border-amber-500/30 p-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-amber-400">03 ///</span> Time Cursor & Ledger Integrity
                </h2>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2 space-y-4">
                        <p class="text-slate-300 text-sm leading-relaxed">
                            The <strong>Mission Session Date</strong> is not just a "current date" field. It acts as a <strong class="text-amber-300">Time Cursor</strong> for the entire financial simulation. 
                            In version 3.0, we've implemented strict synchronization protocols to ensure data integrity during temporal shifts.
                        </p>
                        
                        <div class="space-y-4 mt-6">
                            <div class="flex gap-4 p-4 rounded-lg bg-slate-950/50 border border-slate-800">
                                <div class="mt-1 flex-shrink-0">
                                    <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-600 flex items-center justify-center text-slate-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/></svg>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-slate-200 font-bold mb-1">Temporal Reconciliation</h4>
                                    <p class="text-slate-400 text-xs">
                                        When you advance or retreat the Session Date, the system triggers a <strong>Reconciliation Event</strong>. 
                                        Transactions move between <strong>PENDING</strong> and <strong>POSTED</strong> states automatically, updating Asset credits in real-time.
                                    </p>
                                </div>
                            </div>

                             <div class="flex gap-4 p-4 rounded-lg bg-slate-950/50 border border-slate-800">
                                <div class="mt-1 flex-shrink-0">
                                    <div class="w-8 h-8 rounded-full bg-amber-500/20 border border-amber-500/50 flex items-center justify-center text-amber-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M25 21l-7-7m0 0l7-7m-7 7H3"/></svg>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-amber-200 font-bold mb-1">Immutability & Reversal</h4>
                                    <p class="text-slate-400 text-xs">
                                        To maintain a proper audit trail, <strong>POSTED</strong> transactions are historically locked. 
                                        Corrections generate a <strong>REVERSAL</strong> entry (cancelling the original amount) followed by a new transaction, preserving the timeline truth.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="rounded-lg bg-amber-950/20 border border-amber-500/20 p-5">
                            <h3 class="text-xs font-bold text-amber-100 uppercase tracking-wider mb-2">Automated Ledger Logic</h3>
                            <ul class="space-y-3 text-xs text-slate-300">
                                <li class="flex gap-2">
                                    <span class="text-emerald-400 font-mono">1.</span>
                                    <span><strong>Effective Date:</strong> If Transaction Date <= Session Date, it is <strong>POSTED</strong> (Green) and affects the balance.</span>
                                </li>
                                <li class="flex gap-2">
                                    <span class="text-amber-400 font-mono">2.</span>
                                    <span><strong>Pending Date:</strong> If Transaction Date > Session Date, it is <strong>PENDING</strong> (Yellow) and does not touch credits yet.</span>
                                </li>
                                <li class="flex gap-2">
                                    <span class="text-cyan-400 font-mono">3.</span>
                                    <span><strong>Auto-Recovery:</strong> The system resolves entity contexts during Form Submission even if UI components are disabled by JS.</span>
                                </li>
                                <li class="flex gap-2">
                                    <span class="text-rose-400 font-mono">4.</span>
                                    <span><strong>Strict XOR:</strong> Forms enforce a "Choose Existing OR Create New" rule for Banks and Vendors to prevent ambiguity.</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {# 4. SMART INTERFACE #}
        <section id="smart-interface" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-slate-900 border border-cyan-500/30 p-8 overflow-hidden relative">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-32 h-32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>
                </div>
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-cyan-400">04 ///</span> Smart Interface & Hybrid Resolution
                </h2>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="rounded-lg bg-slate-950 p-5 border border-slate-800">
                            <h3 class="text-lg font-bold text-cyan-300 mb-2 font-rajdhani uppercase tracking-widest">Progressive Disclosure</h3>
                            <p class="text-slate-400 text-sm">
                                Fin-Core forms are now <strong>Context-Aware</strong>. You must select an <strong>Asset</strong> first to unlock the ledger fields. 
                                This prevents orphan transactions and ensures every credit is tracked to a specific ship or team.
                            </p>
                        </div>
                        
                        <div class="rounded-lg bg-slate-950 p-5 border border-slate-800">
                            <h3 class="text-lg font-bold text-emerald-300 mb-2 font-rajdhani uppercase tracking-widest">Hybrid Resolution (On-the-fly)</h3>
                            <p class="text-slate-400 text-sm">
                                No more jumping between pages to register a new bank or vendor. 
                                In any form, you can select an existing Company or simply <strong>type a new name</strong>. 
                                The system will resolve the entity on-the-fly, creating the necessary records in the background.
                            </p>
                        </div>
                    </div>

                    <div class="bg-cyan-950/10 rounded-lg p-6 border border-cyan-500/20 flex flex-col justify-center">
                        <h4 class="text-cyan-100 font-bold mb-4 flex items-center gap-2">
                             <span class="flex-shrink-0 w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-400 text-xs">!</span>
                             XOR Validation Protocol
                        </h4>
                        <p class="text-xs text-slate-400 leading-relaxed italic border-l-2 border-cyan-500/30 pl-4 mb-4">
                            "The machine requires binary clarity. You may link a known entity OR define a new one. Attempting both will trigger a Protocol Error (FormError)."
                        </p>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="p-2 bg-slate-950 rounded text-[10px] text-emerald-400 border border-emerald-500/20 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg> Select Registered Bank
                            </div>
                            <div class="p-2 bg-slate-950 rounded text-[10px] text-emerald-400 border border-emerald-500/20 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg> Type New Bank Name
                            </div>
                             <div class="col-span-2 p-2 bg-slate-950 rounded text-[10px] text-rose-400 border border-rose-500/20 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6L6 18M6 6l12 12"/></svg> Selected BOTH (Protocol Error)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {# 5. MODULE DEEP DIVE #}
        <section id="modules" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-purple-950/10 border border-slate-800 p-8">
                <h2 class="text-2xl font-bold text-white mb-8 flex items-center gap-2 font-orbitron">
                    <span class="text-purple-400">05 ///</span> Financial Modules Deep Dive
                </h2>

                <div class="space-y-12">
                    
                    {# INCOME #}
                    <div>
                        <h3 class="text-xl font-bold text-emerald-100 mb-4 border-b border-emerald-500/30 pb-2">
                            A. Income: Smart Transactions
                        </h3>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="prose prose-invert prose-sm">
                                <p>
                                    Income in Nav-Fi³ is "Smart". When you create an income record (like a Cargo Contract), the system doesn't just add a number. It analyzes your <strong>Signature Date</strong> and <strong>Payout Date</strong>.
                                </p>
                                <ul class="list-none space-y-2 pl-0">
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">Deposit Handling:</strong> If you specify a deposit (e.g. 10% on singature), the system creates an immediate transaction for that amount on the <em>Signature Date</em>.
                                    </li>
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">Final Payout:</strong> The remaining amount waits in "Pending" status until the <em>Payout Date</em> arrives.
                                    </li>
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">Bonus Logic:</strong> Early delivery? Add a bonus. It gets summed into the Final Payout transaction automatically.
                                    </li>
                                </ul>
                            </div>
                            <div class="bg-slate-950 rounded-lg border border-emerald-500/10 p-4">
                                <div class="text-xs font-mono text-emerald-500/50 mb-2 uppercase">Example Flow</div>
                                <div class="space-y-2 text-xs">
                                    <div class="flex justify-between p-2 bg-slate-900 rounded border border-emerald-500/20">
                                        <span class="text-slate-300">Contract Signature</span>
                                        <span class="text-emerald-400">+10,000 Cr (Deposit)</span>
                                    </div>
                                    <div class="flex justify-center text-slate-600">↓ Time Passes ↓</div>
                                    <div class="flex justify-between p-2 bg-slate-900 rounded border border-emerald-500/20">
                                        <span class="text-slate-300">Cargo Delivery</span>
                                        <span class="text-emerald-400">+90,000 Cr (Payout)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {# COSTS #}
                    <div>
                        <h3 class="text-xl font-bold text-amber-100 mb-4 border-b border-amber-500/30 pb-2">
                            B. Costs: Granular Tracking
                        </h3>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div class="prose prose-invert prose-sm">
                                <p>
                                    Costs are the heartbeat of the simulation. Every credit spent is categorized and time-stamped.
                                </p>
                                <ul class="list-none space-y-2 pl-0">
                                    <li class="pl-4 border-l-2 border-amber-500/30">
                                        <strong class="text-amber-300">Categories:</strong> Fuel, Life Support, Maintenance, Salaries, Berthing. Using these consistently feeds the Annual Budget analysis.
                                    </li>
                                    <li class="pl-4 border-l-2 border-amber-500/30">
                                        <strong class="text-amber-300">Legal Context:</strong> You can tag costs with a "Local Law" or Jurisdiction. Vital for campaigns where compliance matters (or bribes need tracking).
                                    </li>
                                    <li class="pl-4 border-l-2 border-amber-500/30">
                                        <strong class="text-amber-300">Line Items:</strong> A single "Cost" record (e.g. "Starport Refuel") can have multiple line items (Fuel x50 tons, Life Support x2 weeks), creating a detailed manifest.
                                    </li>
                                </ul>
                            </div>
                             <div class="bg-slate-950 rounded-lg border border-amber-500/10 p-4">
                                <div class="text-xs font-mono text-amber-500/50 mb-2 uppercase">Budget Impact</div>
                                <p class="text-xs text-slate-400 mb-3">
                                    Costs are deducted on their <strong>Payment Date</strong>. If you defer payment (put it "on the tab"), set the date in the future. The debt will loom in your ledger until that day arrives.
                                </p>
                            </div>
                        </div>
                    </div>

                    {# SALARY #}
                    <div id="salary-module" class="scroll-mt-6">
                        <h3 class="text-xl font-bold text-emerald-100 mb-4 border-b border-emerald-500/30 pb-2">
                            C. Salaries: 28-Day Imperial Cycle
                        </h3>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="prose prose-invert prose-sm">
                                <p>
                                    Running a crew is not free. The Salary module automates the rigid Imperial standard of a <strong>28-day lunar pay cycle</strong>.
                                </p>
                                <ul class="list-none space-y-2 pl-0">
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">Pro-Rata Logic:</strong> New hires don't get a full month. The system calculates `(Salary / 28) * Days` automatically for the first check.
                                    </li>
                                    <li class="pl-4 border-l-2 border-emerald-500/30">
                                        <strong class="text-emerald-300">History:</strong> Every contract change (raise, promotion) is tracked. Old salary records are preserved for historical ledger integrity.
                                    </li>
                                </ul>
                            </div>
                            <div class="bg-slate-950 rounded-lg border border-emerald-500/10 p-4">
                                <div class="text-xs font-mono text-emerald-500/50 mb-2 uppercase">Payroll Ledger</div>
                                <p class="text-xs text-slate-400 mb-3">
                                    Payments are generated as <strong>SalaryPayment</strong> entities. They link directly to the Asset Ledger, ensuring "Cashflow" reports are accurate to the credit.
                                </p>
                            </div>
                        </div>
                    </div>

                    {# MORTGAGE #}
                    <div>
                        <h3 class="text-xl font-bold text-cyan-100 mb-4 border-b border-cyan-500/30 pb-2">
                            D. Mortgage: The Long Game
                        </h3>
                        <a href="/" class="text-2xl font-bold font-orbitron tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 hover:to-cyan-300 transition-all duration-300">
                        NAV-FI³
                    </a>
                        <div class="prose prose-invert prose-sm max-w-none">
                            <p>
                                The classic Traveller burden. Nav-Fi³ handles the math so you can focus on the stress.
                            </p>
                            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">Asset Eligibility</strong>
                                    <span class="text-slate-400 text-xs text-balance">Only <strong>Ships</strong> and <strong>Bases</strong> are mortgage-eligible. Teams are too transient for Imperial bank financing.</span>
                                </div>
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">Standard Terms</strong>
                                    <span class="text-slate-400 text-xs">40 Years, 480 payments. The default Traveller standard.</span>
                                </div>
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">Amortization</strong>
                                    <span class="text-slate-400 text-xs">Calculates principal vs interest for every month automatically.</span>
                                </div>
                                <div class="p-3 bg-slate-900 rounded border border-cyan-500/20">
                                    <strong class="block text-cyan-300 text-xs uppercase mb-1">The Captain</strong>
                                    <span class="text-slate-400 text-xs">A mortgage <strong>requires</strong> a Captain. Links crew hierarchy to the debt.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        {# 6. SYSTEM PROTOCOLS #}
        <section id="protocols" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-slate-900 border border-slate-800 p-8">
                <h2 class="text-2xl font-bold text-white mb-8 flex items-center gap-2 font-orbitron">
                    <span class="text-rose-500">06 ///</span> Critical System Protocols
                </h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                {# SYNC #}
                <div class="p-4 rounded-lg bg-emerald-500/5 border border-emerald-500/20">
                    <div class="text-[10px] uppercase tracking-widest text-emerald-400 mb-2 font-bold font-rajdhani">System Event</div>
                    <h3 class="text-sm font-bold text-white mb-2">Temporal Reconciliation</h3>
                    <p class="text-xs text-slate-400 leading-relaxed">
                        Triggered by confirming Session Date. Future liabilities are converted to current debt and solvency is recalculated.
                    </p>
                </div>

                {# REVERSAL #}
                <div class="p-4 rounded-lg bg-amber-500/5 border border-amber-500/20">
                    <div class="text-[10px] uppercase tracking-widest text-amber-400 mb-2 font-bold font-rajdhani">Audit Alarm</div>
                    <h3 class="text-sm font-bold text-white mb-2">Ledger Integrity</h3>
                    <p class="text-xs text-slate-400 leading-relaxed">
                        Triggered by modifying a past record. The correction is queued and the original error archived for forensic audit.
                    </p>
                </div>

                {# PENDING #}
                <div class="p-4 rounded-lg bg-cyan-500/5 border border-cyan-500/20">
                    <div class="text-[10px] uppercase tracking-widest text-cyan-400 mb-2 font-bold font-rajdhani">Status State</div>
                    <h3 class="text-sm font-bold text-white mb-2">Causality Locked</h3>
                    <p class="text-xs text-slate-400 leading-relaxed">
                        Transactions scheduled for a future date. They remain ineffective until the Time Cursor (Session Date) arrives.
                    </p>
                </div>

                {# HARD DECK #}
                <div class="p-4 rounded-lg bg-rose-500/5 border border-rose-500/20">
                    <div class="text-[10px] uppercase tracking-widest text-rose-400 mb-2 font-bold font-rajdhani">Critical Warning</div>
                    <h3 class="text-sm font-bold text-white mb-2">Hard Deck Breach</h3>
                    <p class="text-xs text-slate-400 leading-relaxed">
                        Fiscal sustainability protocol violation. Your asset is operating with negative credits. Seizure risk imminent.
                    </p>
                </div>
            </div>
        </section>

        {# 7. ECONOMIC HUD & NAVIGATION #}
        <section id="economic-nav" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-cyan-950/20 border border-cyan-500/30 p-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-cyan-400">07 ///</span> Economic HUD & Navigation Link
                </h2>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="rounded-lg bg-slate-950 p-5 border border-slate-800">
                            <h3 class="text-lg font-bold text-cyan-300 mb-2 font-rajdhani uppercase tracking-widest">Navigation HUD Integration</h3>
                            <p class="text-slate-400 text-sm">
                                The Financial Core is now unified with the <strong>Tactical Navigation HUD</strong>. Jump events are not just narrative—they are financial triggers.
                            </p>
                            <ul class="text-slate-300 text-xs space-y-2 mt-4 list-disc pl-4">
                                <li><strong>Fuel Logistics:</strong> Burn rates are calculated based on <strong>Real Parsec Distances</strong>, ensuring your ledger reflects actual jump costs.</li>
                                <li><strong>Auto-Temporal Sync:</strong> Every Jump-Transit automatically advances the session clock by <strong>7 days</strong>, triggering pending ledger entries (Mortgages, Salaries).</li>
                            </ul>
                        </div>
                    </div>

                    <div class="bg-cyan-950/10 rounded-lg p-6 border border-cyan-500/20">
                         <h4 class="text-xs font-bold text-cyan-100 uppercase tracking-widest mb-4">Jump-Sync Financial Protocol</h4>
                         <div class="space-y-3">
                             <div class="p-3 bg-slate-900/60 rounded border border-cyan-500/20 flex items-start gap-3">
                                 <div class="text-cyan-400">{% include 'icons/routes.html.twig' with { dim: 16 } %}</div>
                                 <div>
                                     <p class="text-[11px] font-bold text-white">Engagement Mode</p>
                                     <p class="text-[10px] text-slate-500 italic">Financial accounts are locked during transit to prevent causality paradoxes.</p>
                                 </div>
                             </div>
                             <div class="p-3 bg-slate-900/60 rounded border border-emerald-500/20 flex items-start gap-3">
                                 <div class="text-emerald-400"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M5 5h14M5 19h14M2 12h20L12 2z"/></svg></div>
                                 <div>
                                     <p class="text-[11px] font-bold text-white">Credit Audit</p>
                                     <p class="text-[10px] text-slate-500 italic">Fuel costs are logged as 'SHIP_MAINT' ledger entries post-jump.</p>
                                 </div>
                             </div>
                         </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="workflows" class="mb-12 scroll-mt-6">
            <div class="rounded-xl bg-gradient-to-br from-slate-900 via-slate-900 to-cyan-950/10 border border-slate-800 p-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 font-orbitron">
                    <span class="text-cyan-400">05 ///</span> Practical Workflows
                </h2>
                <div class="grid md:grid-cols-2 gap-6">
                    {# Standard Campaign #}
                    <div class="rounded-lg bg-slate-900/60 border border-cyan-500/20 p-6">
                        <h3 class="text-lg font-bold text-cyan-100 mb-4 font-orbitron uppercase">Workflow: The Free Trader</h3>
                        <ol class="space-y-4 text-sm text-slate-300 list-decimal pl-4 marker:text-cyan-500 font-medium">
                            <li>
                                <strong>Start Session:</strong> Check the <em>Mission Date</em>. Update it to "Today".
                            </li>
                            <li>
                                <strong>Check Ledger:</strong> Look at the Asset Ledger. Did any automatic payments (Mortgage, Salary) trigger when you advanced the date?
                            </li>
                            <li>
                                <strong>Log Activity:</strong> Add new Income (Contracts) and Costs (Fuel, Repairs) as they happen at the table.
                            </li>
                            <li>
                                <strong>End Session:</strong> Advance the date if time passed. The Ledger will lock "Posted" transactions.
                            </li>
                        </ol>
                    </div>

                    {# Mercenary / No Ship #}
                    <div class="rounded-lg bg-slate-900/60 border border-emerald-500/20 p-6">
                        <h3 class="text-lg font-bold text-emerald-100 mb-4 font-orbitron uppercase">Workflow: Ground Unit (No Ship)</h3>
                        <ol class="space-y-4 text-sm text-slate-300 list-decimal pl-4 marker:text-emerald-500 font-medium">
                            <li>
                                <strong>Create "Team":</strong> Create an Asset entity named "Bravo Company". Leave fittings empty.
                            </li>
                            <li>
                                <strong>Log Logistics:</strong> Use "Costs" to track ammo, rations, and bribes. Categorize under "Maintenance" or "Life Support".
                            </li>
                            <li>
                                <strong>Contracts:</strong> Use "Income" to log your merc tickets. The split payment logic (Deposit vs Completion) is perfect for merc contracts.
                            </li>
                            <li>
                                <strong>Paychecks:</strong> Standard Crew Salary functions work perfectly for your team members.
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        {# Footer CTA #}
        <div class="rounded-xl bg-gradient-to-r from-cyan-900/20 to-amber-900/20 border border-slate-700 p-8 text-center sticky bottom-4 backdrop-blur-sm">
            <h3 class="text-xl font-bold text-white mb-3 font-orbitron">Ready to Master Your Credits?</h3>
            <div class="flex items-center justify-center gap-4">
                <a href="{{ path('app_campaign_index') }}" class="btn btn-primary btn-sm px-6 font-orbitron uppercase text-[10px] tracking-widest font-bold">
                    Create Mission
                </a>
                <a href="{{ path('app_home') }}" class="btn btn-outline btn-secondary btn-sm px-6 font-orbitron uppercase text-[10px] tracking-widest font-bold">
                    Back to Home
                </a>
            </div>
        </div>

    </div>
{% endblock %}
