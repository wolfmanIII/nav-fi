{% extends 'base.html.twig' %}

{% block title %}Operations Flow{% endblock %}

{% block pageContent %}
<div class="min-h-[80vh] space-y-8">
    
    {# HERO SECTION #}
    <div class="relative overflow-hidden rounded-2xl bg-slate-950 border border-slate-800 p-8 shadow-lg">
         <div class="absolute top-0 right-0 p-4 opacity-10">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-64 h-64 text-cyan-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0.5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <div class="relative z-10 flex flex-col gap-4 max-w-4xl">
             <div class="flex items-center gap-2 text-cyan-400/80 mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-4">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M3 12h18M8 7l-2 5 2 5M16 7l2 5-2 5"></path>
                </svg>
                <p class="text-xs uppercase tracking-[0.3em] font-orbitron font-bold">Standard Operating Procedure</p>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight leading-none font-orbitron">
                Operations <span class="text-cyan-500">Flow</span>
            </h1>
            <p class="text-lg text-slate-400 leading-relaxed font-light">
                Operational dossier: from mission clock to signed credits. This briefing lays out the full administrative flow: Mission, Company, Crew, Asset, Mortgage, Income, Cost, Annual Budget and the rules that keep them coherent. 
                <span class="text-amber-400/80 font-bold italic">Coherence is fully advisory: the Referee has total tactical control over all data.</span>
            </p>
            
            <div class="flex flex-wrap gap-2 mt-2">
                {% for tag in ['Cross-mission Companies', 'Imperial Dates', 'Crew Status Timeline', 'Session Timeline Logs', 'Mortgage Signature', 'Contract PDFs', 'Template Version', 'Asset Amendments', 'Routes & TRAVELLERMAP.COM'] %}
                     <span class="px-3 py-1.5 rounded bg-slate-900 border border-slate-700 text-xs font-bold tracking-wider text-slate-400 uppercase">{{ tag }}</span>
                {% endfor %}
            </div>
        </div>
    </div>

    {# GRID #}
    <div class="grid gap-6 md:grid-cols-2">
        
        {# Mission #}
        <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/alien-structure-1.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Mission Directive</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Mission</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-2">
                The mission is the master clock. Set starting year and session date (day/year) and keep it updated as in‑game time advances. Every downstream date, limit, and PDF reads from this clock.
            </p>
            <p class="text-xs text-amber-400/80 italic mb-4 border-l-2 border-amber-500/30 pl-3">
                A Mission can be an entire campaign or a single adventure—use whatever scope fits your table.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Session date drives form limits and PDF “generated on” stamps.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Assets inherit the mission calendar for all day/year fields.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Every update is logged as a session timeline entry with a JSON snapshot.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Mission is the anchor for costs, income, and mortgage signatures.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Dates are normalized everywhere as DDD/YYYY.</span>
                </li>
            </ul>
        </div>

        {# Company #}
        <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/company.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Counterparty Registry</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Company</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Companies are cross‑mission entities. Register them once with roles, contact data, and LocalLaw; reuse them in any mission without duplicating legal metadata.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>LocalLaw data flows into Cost/Income/Mortgage PDFs.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Company roles clarify counterparties across all contracts.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Cross‑mission reuse keeps signatures consistent.</span>
                </li>
            </ul>
        </div>

        {# Crew #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/crew.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Roster Protocol</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Crew</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Crew status is a timeline. When assigned from the unassigned roster, the crew member is set to Active and stamped with the session date.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Statuses: Active, On Leave, Retired, Missing (MIA), Deceased.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Unassigned lists exclude Missing/Deceased by default.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Detaching a crew from an asset clears Active/On Leave/Retired dates and status.</span>
                </li>
            </ul>
        </div>

        {# Asset #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/far-trader.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Asset Manifest</p>
            </div>
                <div class="text-cyan-500/50 group-hover:text-cyan-400 transition-colors">
                    {% include 'icons/assets.html.twig' with { dim: 20 } %}
                </div>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Register Assets</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Assets are the core entity. Each asset (Ship, Base, Team) has a crew roster and optional Financial Core modules. Ships also have detailed specification sheets.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Asset details track drives, systems, and total component cost.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Mission association synchronizes all day/year fields.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Crew assignments and roles are managed per asset.</span>
                </li>
            </ul>
        </div>

         {# Amendments #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/ship-components.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Patch Log</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Asset Amendments</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Signed assets change through amendments. Link each amendment to a technical cost with payment date; that payment date becomes the amendment’s effective day/year.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Cost ref is mandatory and must have payment day/year.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Costs already used by other amendments are excluded.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Amendments are logged in the asset PDF for auditing.</span>
                </li>
            </ul>
        </div>
        
         {# Routes #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/routes.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Nav Dossier</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Routes</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Routes are built from waypoints and tied to an Asset + Mission. Each waypoint carries a sector name or T5SS abbreviation plus its 4‑digit hex for TravellerMap.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Start/Destination hex are auto‑sealed from the first and last waypoint.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Jump distances and fuel estimate are calculated on submit.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Map links open `TRAVELLERMAP.COM` via coordinate sync for quick visual checks.</span>
                </li>
            </ul>
        </div>

        {# Mortgage #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/handbook.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Lien File</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Mortgage</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Mortgages are signed using the mission session date and a recorded signing location. A signed mortgage can be printed as an official record or kept as a draft.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Signing stamps day/year + location and locks PDF metadata.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Crew panels in UI/PDF only show Active crew on or after the signing date.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Installments follow the Traveller 13‑period year.</span>
                </li>
            </ul>
        </div>

        {# Income #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/income.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Revenue Docket</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Income</h3>
                Records all revenue streams with automated logic to handle deposits, bonuses, and final payments based on dates. System auto-splits Deposits (Signing Date) and Balances (Payment Date).
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Imperial dates are shown as DDD/YYYY with optional clear.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Status flips Draft → Signed when signing day/year is complete.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Contract PDFs mirror the data structure and include template version.</span>
                </li>
            </ul>
        </div>

        {# Cost #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/cost.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Expense Ledger</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Cost</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Costs are logged per asset with detailed line items. LocalLaw and counterparties are printed in PDF for jurisdictional clarity.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Detail items feed the computed amount field (read‑only).</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Payment dates use imperial day/year.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>PDF formatting stays consistent across contracts (template versioned).</span>
                </li>
            </ul>
        </div>

        {# Budget #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/annual-budget.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Balance Strip</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Annual Budget</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                 Annual Budget is the asset’s fiscal strip for the session year: it aggregates Income, Cost, and mortgage installments into a single operational readout.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>One budget per asset, tied to imperial start/end day/year.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Timeline blends payouts, upkeep, and debt across 13 periods.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Use it to forecast solvency before the next jump.</span>
                </li>
            </ul>
        </div>

        {# REFEREE RESPONSIBILITY #}
        <div class="md:col-span-2 group relative flex flex-col rounded-xl border border-amber-500/20 bg-gradient-to-br from-slate-950 via-amber-950/5 to-slate-950 p-6 shadow-lg transition-all hover:border-amber-500/40">
             <div class="flex items-center gap-2 text-amber-500/50 group-hover:text-amber-400 mb-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="size-5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Referee Tactical Control</p>
            </div>
            <h3 class="text-xl font-bold text-amber-100 group-hover:text-amber-400 transition-colors font-orbitron mb-3">Advisory Validation & Referee Control</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Nav-Fi uses an advisory validation model. The system provides guidance through alerts but never hard-locks records based on signed/paid status or session dates.
            </p>
            <div class="grid md:grid-cols-2 gap-6">
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                        <span><strong class="text-white">Informational Notices:</strong> Timeline inconsistencies (e.g., payment before mission start) display informational notices without blocking saves. The Referee maintains full control over data coherence.</span>
                    </li>
                    <li class="pl-4 border-l-2 border-amber-500/30">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                        <span>
                            <strong class="text-white">Unrestricted Editing:</strong> Paid costs, signed incomes, and signed mortgages remain editable. Use this power to correct tactical errors or reflect narrative changes.
                        </span>
                    </li>
                </ul>
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-red-500"></span>
                        <span><strong class="text-white">Cascading Deletion:</strong> Removing a primary object (especially an <strong class="text-white">Asset</strong>) will automatically delete all linked history: Mortgage, Installments, Costs, Incomes, and Routes.</span>
                    </li>
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-red-500"></span>
                        <span><strong class="text-white">Data Permanent Removal:</strong> Exercise tactical caution when deleting assets; once confirmed, the associated ledger cannot be recovered via standard UI.</span>
                    </li>
                </ul>
            </div>
        </div>

    </div>
</div>
{% endblock %}
