{% extends 'base.html.twig' %}

{% block title %}Operations Flow{% endblock %}

{% block pageContent %}
<div class="min-h-[80vh] space-y-8">
    
    {# HERO SECTION #}
    <div class="relative overflow-hidden rounded-2xl bg-slate-950 border border-slate-800 p-8 shadow-lg">
         <div class="absolute top-0 right-0 p-4 opacity-10">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-64 h-64 text-cyan-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0.5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <div class="relative z-10 flex flex-col gap-4 max-w-4xl">
             <div class="flex items-center gap-2 text-cyan-400/80 mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-4">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M3 12h18M8 7l-2 5 2 5M16 7l2 5-2 5"></path>
                </svg>
                <p class="text-xs uppercase tracking-[0.3em] font-orbitron font-bold">Standard Operating Procedure</p>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight leading-none font-orbitron">
                Operations <span class="text-cyan-500">Flow</span>
            </h1>
            <p class="text-lg text-slate-400 leading-relaxed font-light">
                Operations Dossier: from mission clock to signed credits. This briefing details the entire administrative flow: Mission, Company, Crew, Asset, Mortgage, Income, Costs, Annual Budget and the rules that keep them consistent.
                <span class="text-amber-400/80 font-bold italic">Consistency is purely advisory: the Referee has total tactical control over all data.</span>
            </p>
            
            <div class="flex flex-wrap gap-2 mt-2">
                {% for tag in ['Cross-mission Companies', 'Imperial Dates', 'Crew Timeline Status', 'Session Timeline Log', 'Mortgage Signing', 'Contract PDFs', 'Template Versioning', 'Asset Amendment', 'Routes & TRAVELLERMAP.COM'] %}
                     <span class="px-3 py-1.5 rounded bg-slate-900 border border-slate-700 text-xs font-bold tracking-wider text-slate-400 uppercase">{{ tag }}</span>
                {% endfor %}
            </div>
        </div>
    </div>

    {# GRID #}
    <div class="grid gap-6 md:grid-cols-2">
        
        {# Mission #}
        <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/alien-structure-1.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Mission Directive</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Mission</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-2">
                The mission is the master clock. Set the starting year and session date (day/year) and keep it updated as game time advances. Every downstream date, limit, and PDF reads from this clock.
            </p>
            <p class="text-xs text-amber-400/80 italic mb-4 border-l-2 border-amber-500/30 pl-3">
                A Mission can be an entire campaign or a single adventure: use the scope that fits your table.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Session date drives form limits and PDF "generated on" stamps.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Assets inherit the mission calendar for all day/year fields.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Every update is logged as a session timeline entry with a JSON snapshot.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>The mission is the anchor for costs, income, and mortgage signings.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Dates are normalized everywhere as DDD/YYYY.</span>
                </li>
            </ul>
        </div>

        {# Company #}
        <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/company.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Counterparty Registry</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Company</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Companies are cross-mission entities. Register them once with roles, contact data, and Local Laws; reuse them in any mission without duplicating legal metadata.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Local Law data flows into Cost/Income/Mortgage PDFs.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Company roles clarify counterparties in all contracts.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Cross-mission reuse keeps signatures consistent.</span>
                </li>
            </ul>
        </div>

        {# Crew #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/crew.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Manifest Protocol</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Crew</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Crew status is a timeline. When assigned from the "unassigned" pool, the crew member is set to Active and stamped with the session date.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Status: Active, On Leave, Retired, Missing (MIA), Deceased.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Unassigned lists exclude MIA/Deceased by default.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Detaching a crew from an asset clears Active/Leave/Retired dates and status.</span>
                </li>
            </ul>
        </div>

        {# Asset #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/assets.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Asset Manifest</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Register Assets</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Assets are the core entity. Every asset (Ship, Base, Team) has a crew manifest and optional Financial Core modules. Ships also have detailed technical spec sheets.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Asset details track drives, systems, and total component cost.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Mission association syncs all day/year fields.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Crew assignments and roles are managed per asset.</span>
                </li>
            </ul>
        </div>

         {# Amendments #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/ship-components.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Patch Log</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Asset Amendment</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Signed assets change via Amendments. Link each amendment to a technical cost with a payment date; that date becomes the effective day/year of the amendment.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Cost ref is mandatory and must have payment day/year.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Costs already used by other amendments are excluded.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Amendments are recorded in the Asset PDF for audit.</span>
                </li>
            </ul>
        </div>
        
         {# Routes #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/routes.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Nav Dossier</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Routes</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Routes are built from waypoints and linked to Asset + Mission. Each waypoint carries a sector name or T5SS abbreviation plus its 4-digit hex for TravellerMap.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Start/Dest hex is auto-sealed by the first and last waypoint.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Jump distances and fuel estimates are calculated on submit.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Map links open `TRAVELLERMAP.COM` via coordinate sync for quick visual checks.</span>
                </li>
            </ul>
        </div>

        {# Mortgage #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/handbook.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Pledge Files</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Mortgage</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Mortgages are signed using the mission session date and a registered signing location. A signed mortgage can be printed as an official record or kept as a draft.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Signature stamps day/year + location and locks PDF metadata.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Crew panels in UI/PDF show only Active crew at signature date or later.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Payments follow the Traveller 13-period year.</span>
                </li>
            </ul>
        </div>

        {# Income #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/income.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Revenue Docket</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Income</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Record all revenue streams with automated logic to handle deposits, bonuses, and final payouts. Now includes a <strong>Cancellation Workflow</strong> with visual VOID badges and PDF watermarks.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>System auto-splits Deposits (Signature Date) vs Balances (Payout Date).</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span><strong>CancelDate Support:</strong> Automatically marks related future transactions as VOID.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Contract PDFs for cancelled income show a high-visibility watermark.</span>
                </li>
            </ul>
        </div>

        {# Cost #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/cost.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Expense Ledger</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Costs</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Costs are logged per asset with line items. Local Law and counterparties are printed in PDF for jurisdictional clarity.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Line items feed the calculated amount field (read-only).</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Payment dates use Imperial day/year.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>PDF formatting remains consistent across contracts (versioned templates).</span>
                </li>
            </ul>
        </div>

        {# Budget #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/annual-budget.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Balance Strip</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Annual Budget</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                 The Annual Budget is the asset's fiscal strip for the session year: it aggregates Income, Costs and mortgage payments into a single operational view.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>One budget per asset, tied to start/end Imperial day/year.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>The timeline merges payments, maintenance, and debt across 13 periods.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Use it to forecast solvency before the next jump.</span>
                </li>
            </ul>
        </div>

        {# REFEREE RESPONSIBILITY #}
        <div class="md:col-span-2 group relative flex flex-col rounded-xl border border-amber-500/20 bg-gradient-to-br from-slate-950 via-amber-950/5 to-slate-950 p-6 shadow-lg transition-all hover:border-amber-500/40">
             <div class="flex items-center gap-2 text-amber-500/50 group-hover:text-amber-400 mb-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="size-5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Referee Tactical Control</p>
            </div>
            <h3 class="text-xl font-bold text-amber-100 group-hover:text-amber-400 transition-colors font-orbitron mb-3">Advisory Validation & Referee Control</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Nav-Fi&sup3; uses an advisory validation model. The system provides guidance via alerts but never blocks "hard" records based on signed/paid status or session dates.
            </p>
            <div class="grid md:grid-cols-2 gap-6">
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                        <span><strong class="text-white">Advisory Alerts:</strong> Timeline inconsistencies (e.g. payment before mission start) show informational alerts without blocking saves. The Referee maintains total control over data consistency.</span>
                    </li>
                    <li class="pl-4 border-l-2 border-amber-500/30">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                        <span>
                            <strong class="text-white">Unlimited Editing:</strong> Paid costs, signed income, and signed mortgages remain editable. Use this power to correct tactical errors or reflect narrative changes.
                        </span>
                    </li>
                </ul>
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-red-500"></span>
                        <span><strong class="text-white">Cascade Cancellation:</strong> Removing a primary object (especially an <strong class="text-white">Asset</strong>) will automatically cancel all linked history: Mortgage, Installments, Costs, Income, and Routes.</span>
                    </li>
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-red-500"></span>
                        <span><strong class="text-white">Permanent Data Removal:</strong> Exercise tactical caution when deleting assets; once confirmed, the associated ledger cannot be recovered via standard UI.</span>
                    </li>
                </ul>
            </div>
        </div>

    </div>
</div>
{% endblock %}
