{% extends 'base.html.twig' %}

{% block title %}Operations Flow{% endblock %}

{% block pageContent %}
<div class="min-h-[80vh] space-y-8">
    
    {# HERO SECTION #}
    {% embed 'components/_hero_header.html.twig' with {
        icon: 'icons/operations-flow.html.twig',
        theme: 'cyan',
        subheader: 'Standard Operating Procedure',
        title: 'Operations Flow',
        description: 'Operations Dossier: from mission clock to signed credits. This briefing details the entire administrative flow: Mission, Company, Crew, Asset, Mortgage, Income, Costs, Annual Budget and the rules that keep them consistent.'
    } %}
        {% block content %}
             <p class="text-sm text-amber-400/80 font-bold italic mt-2">Consistency is purely advisory: the Referee has total tactical control over all data.</p>
            <div class="flex flex-wrap gap-2 mt-4">
                {% for tag in ['Cross-mission Companies', 'Imperial Dates', 'Crew Timeline Status', 'Session Timeline Log', 'Mortgage Signing', 'Contract PDFs', 'Template Versioning', 'Asset Amendment', 'Routes & TRAVELLERMAP.COM'] %}
                     <span class="px-3 py-1.5 rounded bg-slate-900 border border-slate-700 text-xs font-bold tracking-wider text-slate-400 uppercase">{{ tag }}</span>
                {% endfor %}
            </div>
        {% endblock %}
    {% endembed %}

    {# GRID #}
    <div class="grid gap-6 md:grid-cols-2">
        
        {# Mission #}
        <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/alien-structure-1.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Mission Directive</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Mission</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-2">
                The mission is the master clock. Set the starting year and session date (day/year) and keep it updated as game time advances. Every downstream date, limit, and PDF reads from this clock.
            </p>
            <p class="text-xs text-amber-400/80 italic mb-4 border-l-2 border-amber-500/30 pl-3">
                A Mission can be an entire campaign or a single adventure: use the scope that fits your table.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Session date drives form limits and PDF "generated on" stamps.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Assets inherit the mission calendar for all day/year fields.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Every update is logged as a session timeline entry with a JSON snapshot.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>The mission is the anchor for costs, income, and mortgage signings.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Dates are normalized everywhere as DDD/YYYY.</span>
                </li>
            </ul>
        </div>

        {# Company #}
        <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/company.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Counterparty Registry</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Company</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Companies are cross-mission entities. Register them once with roles, contact data, and Local Laws; reuse them in any mission without duplicating legal metadata.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Local Law data flows into Cost/Income/Mortgage PDFs.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Company roles clarify counterparties in all contracts.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Cross-mission reuse keeps signatures consistent.</span>
                </li>
            </ul>
        </div>

        {# Crew #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/crew.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Manifest Protocol</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Crew</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Crew status is a timeline. When assigned from the "unassigned" pool, the crew member is set to Active and stamped with the session date.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Status: Active, On Leave, Retired, Missing (MIA), Deceased.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Unassigned lists exclude MIA/Deceased by default.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Detaching a crew from an asset clears Active/Leave/Retired dates and status.</span>
                </li>
            </ul>
        </div>

        {# Asset #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/assets.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Asset Manifest</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Register Assets</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Assets (Ship, Base, Team) are the core accounting units. Every asset automatically gains a <strong>Financial Account (Wallet)</strong> to store its credits and link to the Ledger.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span><strong>Wallet Core:</strong> Assets cannot exist without a linked financial account.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Mission association syncs the session clock to the asset's wallet.</span>
                </li>
                  <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Technical specs and crew hierarchies are anchored to this entity.</span>
                </li>
            </ul>
        </div>

         {# Amendments #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/ship-components.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Patch Log</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Asset Amendment</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Signed assets change via Amendments. Link each amendment to a technical cost with a payment date; that date becomes the effective day/year of the amendment.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Cost ref is mandatory and must have payment day/year.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Costs already used by other amendments are excluded.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Amendments are recorded in the Asset PDF for audit.</span>
                </li>
            </ul>
        </div>
        
         {# Routes #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/routes.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Nav Dossier</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Routes</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Routes are built from waypoints and linked to Asset + Mission. Each waypoint carries a sector name or T5SS abbreviation plus its 4-digit hex for TravellerMap.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Start/Dest hex is auto-sealed by the first and last waypoint.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Jump distances and fuel estimates are calculated on submit.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Map links open `TRAVELLERMAP.COM` via coordinate sync for quick visual checks.</span>
                </li>
            </ul>
        </div>

        {# Mortgage #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/handbook.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Pledge Files</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Mortgage</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Mortgages are signed using the mission session date. Documentation parity ensures that existing accounts are reused or new ones created on-the-fly with <strong>Strict XOR Validation</strong>.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Signature stamps day/year + location and locks PDF metadata.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span><strong>Smart Visibility:</strong> Ledger fields appear only after Asset selection.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Payments follow the Traveller 13-period year.</span>
                </li>
            </ul>
        </div>

        {# Income #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/income.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Revenue Docket</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Income</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Record all revenue with automated handling of deposits and payouts. Features <strong>Hybrid Resolution</strong> for Payer/Alias and <strong>Exclusive Selection</strong> for receiver accounts.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>System auto-splits Deposits (Signature Date) vs Balances (Payout Date).</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span><strong>Creation on-the-fly:</strong> Register new Patrons or Accounts directly in the form.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Contract PDFs for cancelled income show a high-visibility watermark.</span>
                </li>
            </ul>
        </div>

        {# Cost #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/cost.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Expense Ledger</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Costs</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Costs are time-aware events. Every credit spent is deducted on the <strong>Payment Date</strong>, with <strong>Smart Visibility</strong> hiding ledger fields until an Asset is selected.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span><strong>Hybrid Resolution:</strong> Create new vendors on-the-fly directly in the form.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>XOR Validation prevents selecting an account AND typing a new one simultaneously.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Line items feed the calculated amount field (read-only).</span>
                </li>
            </ul>
        </div>

        {# Budget #}
         <div class="group relative flex flex-col rounded-xl border border-slate-800 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 shadow-lg transition-all hover:border-cyan-500/30 hover:shadow-cyan-500/10 hover:-translate-y-1">
             <div class="flex items-center gap-2 text-cyan-500/50 group-hover:text-cyan-400 mb-3 transition-colors">
                {% include 'icons/annual-budget.html.twig' with { dim: 20 } %}
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Balance Strip</p>
            </div>
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-cyan-400 transition-colors font-orbitron mb-3">Annual Budget</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                 The Annual Budget is the asset's fiscal strip for the session year: it aggregates Income, Costs and mortgage payments into a single operational view.
            </p>
            <ul class="mt-auto space-y-2">
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>One budget per asset, tied to start/end Imperial day/year.</span>
                </li>
                <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>The timeline merges payments, maintenance, and debt across 13 periods.</span>
                </li>
                 <li class="flex items-start gap-2 text-xs text-slate-500">
                    <span class="mt-1 w-1 h-1 rounded-full bg-cyan-500/50"></span>
                    <span>Use it to forecast solvency before the next jump.</span>
                </li>
            </ul>
        </div>

        {# REFEREE RESPONSIBILITY #}
        <div class="md:col-span-2 group relative flex flex-col rounded-xl border border-amber-500/20 bg-gradient-to-br from-slate-950 via-amber-950/5 to-slate-950 p-6 shadow-lg transition-all hover:border-amber-500/40">
             <div class="flex items-center gap-2 text-amber-500/50 group-hover:text-amber-400 mb-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="size-5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                <p class="text-[10px] uppercase tracking-[0.25em] font-bold font-rajdhani">Referee Tactical Control</p>
            </div>
            <h3 class="text-xl font-bold text-amber-100 group-hover:text-amber-400 transition-colors font-orbitron mb-3">Advisory Validation & Referee Control</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-4">
                Nav-Fi&sup3; uses an advisory validation model. The system provides guidance via alerts but never blocks "hard" records based on signed/paid status or session dates.
            </p>
            <div class="grid md:grid-cols-2 gap-6">
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                        <span><strong class="text-white">Advisory Alerts:</strong> Timeline inconsistencies (e.g. payment before mission start) show informational alerts without blocking saves. The Referee maintains total control over data consistency.</span>
                    </li>
                    <li class="pl-4 border-l-2 border-amber-500/30">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                        <span>
                            <strong class="text-white">Tactical Override:</strong> Use the dedicated <strong>Financial Accounts</strong> page to manually adjust starting credits, change banking institutions, or ricollect accounts independently from the session ledger.
                        </span>
                    </li>
                </ul>
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-red-500"></span>
                        <span><strong class="text-white">Cascade Cancellation:</strong> Removing a primary object (especially an <strong class="text-white">Asset</strong>) will automatically cancel all linked history: Mortgage, Installments, Costs, Income, and Routes.</span>
                    </li>
                    <li class="flex items-start gap-2 text-xs text-slate-300">
                        <span class="mt-1 w-1.5 h-1.5 rounded-full bg-red-500"></span>
                        <span><strong class="text-white">Permanent Data Removal:</strong> Exercise tactical caution when deleting assets; once confirmed, the associated ledger cannot be recovered via standard UI.</span>
                    </li>
                </ul>
            </div>
        </div>

    </div>
</div>
{% endblock %}
