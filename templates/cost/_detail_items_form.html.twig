{% import _self as costDetails %}

{% macro render_item(child) %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 border border-slate-700 bg-slate-950/40 rounded-lg p-4 relative collection-item group hover:border-cyan-500/30 transition-colors">
        <button type="button"
                class="absolute -right-2 -top-2 w-6 h-6 rounded-full bg-slate-800 border border-slate-700 text-slate-400 hover:text-red-400 hover:border-red-500/50 flex items-center justify-center transition-all shadow-lg z-10"
                data-action="cost-details#removeItem">&times;</button>
        <div class="md:col-span-1">
            {{ form_label(child.description) }}
            {{ form_widget(child.description, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
            {{ form_errors(child.description) }}
        </div>
        <div>
            {{ form_label(child.quantity) }}
            {{ form_widget(child.quantity, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
            {{ form_errors(child.quantity) }}
        </div>
        <div>
            {{ form_label(child.cost) }}
            {{ form_widget(child.cost, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
            {{ form_errors(child.cost) }}
        </div>
    </div>
{% endmacro %}

<fieldset class="grid grid-cols-1 bg-slate-900/40 border border-slate-800 gap-6 p-6 rounded-xl shadow-inner mb-6 relative"
         data-controller="cost-details"
         data-cost-details-amount-selector="[name='cost[amount]']">
    <legend class="px-3 py-1 rounded bg-slate-800 border border-slate-700 text-[10px] font-bold font-orbitron tracking-[0.3em] text-emerald-500/80 uppercase">Line Items // Inventory Adjustment</legend>

    {% set detailErrors = form_errors(form.detailItems) %}
    {% if detailErrors is not empty %}
        <div class="alert alert-error bg-red-500/10 border-red-500/30 text-red-500 text-xs rounded-lg mb-4 py-2">
            <div class="flex gap-2 items-center">
                <div class="animate-spin-slow text-current">
                    {% include 'icons/radar.html.twig' with { dim: 16 } %}
                </div>
                <span>{{ detailErrors|raw }}</span>
            </div>
        </div>
    {% endif %}

    <div class="grid grid-cols-1 gap-4" data-cost-details-target="collection">
        <div class="flex items-center justify-between mb-2">
            <h4 class="text-[10px] uppercase tracking-widest font-rajdhani font-bold text-slate-500">Resource Allocation</h4>
            <button type="button" class="btn btn-outline btn-xs font-orbitron uppercase tracking-widest text-[9px]"
                    data-action="cost-details#addItem">+ Add Resource</button>
        </div>
        <div class="space-y-4" data-cost-details-target="list">
            {% for child in form.detailItems %}
                {{ costDetails.render_item(child) }}
            {% endfor %}
        </div>
        <template data-cost-details-target="prototype">
            {{ costDetails.render_item(form.detailItems.vars.prototype) }}
        </template>
    </div>
</fieldset>
