<div
    data-controller="single-select-table"
    class="w-full"
>
    <label class="label">
        <span class="label-text flex items-center gap-1">
            {{ form.insurance.vars.label ?? 'Insurance' }}
            {% if form.insurance.vars.required %}{% include 'icons/required.html.twig' %}{% endif %}
            <button type="button" class="btn badge badge-sm badge-outline badge-info ml-2" onclick="coverage_modal.showModal()">?</button>
        </span>
    </label>

    <div class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100 m-1">
        <table class="table w-full border-separate border-spacing-0 inner-bordered-table">
            <thead>
                <tr>
                    <th class="w-10"></th>
                    <th>Name</th>
                    <th>Annual Cost(% Ship Price)</th>
                </tr>
            </thead>
            <tbody>
            {% for choice in form.insurance.vars.choices %}
                {% set insurance = choice.data %}
                {% set isSelected = (form.insurance.vars.value == choice.value) %}
                <tr
                    data-single-select-table-target="row"
                    class="{% if isSelected %}bg-primary/10{% endif %}"
                >
                    <td>
                        <input
                            type="radio"
                            class="radio radio-sm"
                            name="insurance_radio"  {# nome “finto”, solo per il gruppo #}
                            data-single-select-table-target="radio"
                            data-action="change->single-select-table#select"
                            data-value="{{ choice.value }}"
                            {% if isSelected %}checked{% endif %}
                            {% if mortgage.signed %} disabled {% endif %}
                        >
                    </td>
                    <td>{{ insurance.name }}</td>
                    <td class="text-right">{{ insurance.annualCost|number_format(2, ',', '.') }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {# Hidden effettivamente legato al campo Symfony #}
    <input
        type="hidden"
        name="{{ form.insurance.vars.full_name }}"
        value="{{ form.insurance.vars.value }}"
        data-single-select-table-target="hidden"
    >

    {{ form_errors(form.insurance) }}
    {% do form.insurance.setRendered %}
</div>
