<div
    data-controller="single-select-table"
    class="w-full"
>
    <label class="label">
        <span class="label-text">
            {{ form.interestRate.vars.label ?? 'Interest Rate' }}
            <button type="button" class="btn badge badge-sm badge-outline badge-info ml-2" onclick="interest_rate_modal.showModal()">?</button>
        </span>
    </label>

    <div class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100 m-1">
        <table class="table w-full border-separate border-spacing-0 inner-bordered-table">
            <thead>
                <tr>
                    <th class="w-10"></th>
                    <th>Duration (years)</th>
                    <th>Cost Multiplier</th>
                    <th>Cost Divider</th>
                    <th>Interest Rate (%)</th>
                </tr>
            </thead>
            <tbody>
            {% for choice in form.interestRate.vars.choices %}
                {% set rate = choice.data %}
                {% set isSelected = (form.interestRate.vars.value == choice.value) %}
                <tr
                    data-single-select-table-target="row"
                    class="{% if isSelected %}bg-primary/10{% endif %}"
                >
                    <td>
                        <input
                            type="radio"
                            class="radio radio-sm"
                            name="interestRate_radio"  {# nome “finto”, solo per il gruppo #}
                            data-single-select-table-target="radio"
                            data-action="change->single-select-table#select"
                            data-value="{{ choice.value }}"
                            {% if isSelected %}checked{% endif %}
                            {% if mortgage.signed %} disabled {% endif %}
                        >
                    </td>
                    <td class="text-right">{{ rate.duration }}</td>
                    <td class="text-right">{{ rate.priceMultiplier|number_format(2, ',', '.') }}</td>
                    <td class="text-right">{{ rate.priceDivider }}</td>
                    <td class="text-right">{{ rate.annualInterestRate|number_format(2, ',', '.') }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {# Hidden effettivamente legato al campo Symfony #}
    <input
        type="hidden"
        name="{{ form.interestRate.vars.full_name }}"
        value="{{ form.interestRate.vars.value }}"
        data-single-select-table-target="hidden"
    >

    {{ form_errors(form.interestRate) }}
    {% do form.interestRate.setRendered %}
</div>
