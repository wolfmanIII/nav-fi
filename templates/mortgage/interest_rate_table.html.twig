{% set locale = app.request.locale ?? 'en' %}

<div
    data-controller="single-select-table"
    class="w-full"
>
    <div class="flex items-baseline justify-between h-5 mb-1">
        <label class="mb-0 text-slate-300 text-[10px] uppercase tracking-widest font-bold font-orbitron opacity-50">
            {{ form.interestRate.vars.label ?? 'Interest Rate' }}
        </label>
        <button type="button" class="text-[9px] cursor-pointer text-cyan-500/50 hover:text-cyan-400 transition-colors uppercase font-bold tracking-widest" onclick="interest_rate_modal.showModal()"><b>[info]</b></button>
    </div>

    <div class="overflow-x-auto rounded-xl border border-slate-800 bg-slate-950/40 shadow-inner">
        <table class="table table-xs w-full border-separate border-spacing-0">
            <thead>
                <tr class="border-b border-slate-800">
                    <th class="w-8 bg-slate-900/50"></th>
                    <th class="font-rajdhani uppercase tracking-widest text-[11px] text-slate-400 bg-slate-900/50 text-right">Duration</th>
                    <th class="font-rajdhani uppercase tracking-widest text-[11px] text-slate-400 bg-slate-900/50 text-right">Multiplier</th>
                    <th class="font-rajdhani uppercase tracking-widest text-[11px] text-slate-400 bg-slate-900/50 text-right">Divider</th>
                    <th class="font-rajdhani uppercase tracking-widest text-[11px] text-slate-400 bg-slate-900/50 text-right">Rate (%)</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-800/50">
            {% for choice in form.interestRate.vars.choices %}
                {% set rate = choice.data %}
                {% set isSelected = (form.interestRate.vars.value == choice.value) %}
                <tr
                    data-single-select-table-target="row"
                    class="hover:bg-cyan-500/5 transition-colors {% if isSelected %}bg-emerald-500/10 text-emerald-400{% else %}text-slate-300{% endif %}"
                >
                    <td class="text-center p-2">
                        <input
                            type="radio"
                            class="radio radio-xs radio-primary"
                            name="interestRate_radio"
                            data-single-select-table-target="radio"
                            data-action="change->single-select-table#select"
                            data-value="{{ choice.value }}"
                            {% if isSelected %}checked{% endif %}
                            {% if mortgage.signed %} disabled {% endif %}
                        >
                    </td>
                    <td class="text-right p-2 font-mono text-xs">{{ rate.duration }}y</td>
                    <td class="text-right p-2 font-mono text-xs">{{ rate.priceMultiplier|format_number({ min_fraction_digit: 2, max_fraction_digit: 2 }, 'decimal', 'default', locale) }}</td>
                    <td class="text-right p-2 font-mono text-xs">{{ rate.priceDivider }}</td>
                    <td class="text-right p-2 font-mono text-xs font-bold">{{ rate.annualInterestRate|format_number({ min_fraction_digit: 2, max_fraction_digit: 2 }, 'decimal', 'default', locale) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {# Hidden effettivamente legato al campo Symfony #}
    <input
        type="hidden"
        name="{{ form.interestRate.vars.full_name }}"
        value="{{ form.interestRate.vars.value }}"
        data-single-select-table-target="hidden"
    >

    {{ form_errors(form.interestRate) }}
    {% do form.interestRate.setRendered %}
</div>
