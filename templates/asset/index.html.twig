{% extends 'base.html.twig' %}

{% block title %}Nav-Fi&sup3; - Assets{% endblock %}

{% import '_tooltip.html.twig' as tooltip %}

{% block pageContent %}

    {% set locale = app.request.locale ?? 'en' %}

    <div class="">

    {# HEADER / STATUS BAR #}
    {% set active_category = app.request.query.get('category') %}
    {% set is_categorical = app.request.query.get('view') == 'categorical' %}

    {# Determine icon and color based on category #}
    {% set icon_template = 'icons/assets.html.twig' %}
    {% set icon_theme = 'slate' %}

    {% if is_categorical %}
        {% if active_category == 'ship' %}
            {% set icon_template = 'icons/far-trader.html.twig' %}
            {% set icon_theme = 'cyan' %}
        {% elseif active_category == 'base' %}
            {% set icon_template = 'icons/spaceport.html.twig' %}
            {% set icon_theme = 'amber' %}
        {% elseif active_category == 'team' %}
            {% set icon_template = 'icons/team.html.twig' %}
            {% set icon_theme = 'emerald' %}
        {% endif %}
    {% endif %}

    {% embed 'components/_hero_header.html.twig' with {
        icon: icon_template,
        theme: icon_theme,
        subheader: 'NAV-FI // REGISTRY',
        title: is_categorical ? active_category|upper ~ ' ASSETS' : 'GLOBAL ASSETS',
        titleSuffix: '// Manifest',
        description: 'Registry of mission-critical assets, hulls, and tactical units.'
    } %}
        {% import '_tooltip.html.twig' as tooltip %}
        {% block actions %}
            {% if not is_categorical or active_category == 'ship' %}
                {{ tooltip.link('Launch a new vessel',
                                'Add Ship',
                                'icons/far-trader.html.twig',
                                path('app_asset_new', { category: 'ship' }),
                                { position: 'tooltip-left', dim: 16, linkClass: 'btn btn-outline btn-primary btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' }) }}
            {% endif %}
            
            {% if not is_categorical or active_category == 'base' %}
                 {{ tooltip.link('Establish a new station',
                                'Add Base',
                                'icons/spaceport.html.twig',
                                path('app_asset_new', { category: 'base' }),
                                { position: 'tooltip-left', dim: 16, linkClass: 'btn btn-outline btn-warning btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' }) }}
            {% endif %}

            {% if not is_categorical or active_category == 'team' %}
                 {{ tooltip.link('Register a tactical unit',
                                'Add Team',
                                'icons/team.html.twig',
                                path('app_asset_new', { category: 'team' }),
                                { position: 'tooltip-left', dim: 16, linkClass: 'btn btn-outline btn-success btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' }) }}
            {% endif %}
        {% endblock %}
    {% endembed %}



        {% set filter_fields %}
            <div>
                <label class="label text-xs uppercase tracking-[0.2em] text-cyan-500/60 font-bold">OPS_CAMPAIGN</label>
                <select name="campaign" class="select w-full bg-slate-950/50 border-slate-800 text-cyan-100 focus:border-cyan-500/50">
                    <option value="">ALL_OPERATIONS</option>
                    {% for campaign in campaigns %}
                        <option value="{{ campaign.id }}" {% if filters.campaign == campaign.id %}selected{% endif %}>
                            {{ campaign.title }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            {% if not is_categorical %}
                <div>
                    <label class="label text-xs uppercase tracking-[0.2em] text-cyan-500/60 font-bold">CATEGORY</label>
                    <select name="category" class="select w-full bg-slate-950/50 border-slate-800 text-cyan-100 focus:border-cyan-500/50">
                        <option value="">ALL_CATEGORIES</option>
                        <option value="base" {% if filters.category == 'base' %}selected{% endif %}>Base</option>
                        <option value="ship" {% if filters.category == 'ship' %}selected{% endif %}>Ship</option>
                        <option value="team" {% if filters.category == 'team' %}selected{% endif %}>Team</option>
                    </select>
                </div>
            {% else %}
                <input type="hidden" name="category" value="{{ active_category }}">
                <input type="hidden" name="view" value="categorical">
            {% endif %}
            <div>
                <label class="label text-xs uppercase tracking-[0.2em] text-cyan-500/60 font-bold">ASSET_NAME</label>
                <input type="text" name="name" value="{{ filters.name }}" class="input w-full bg-slate-950/50 border-slate-800 text-cyan-100 placeholder:text-slate-600 focus:border-cyan-500/50" placeholder="Search by name...">
            </div>
            <div>
                <label class="label text-xs uppercase tracking-[0.2em] text-cyan-500/60 font-bold">TYPE_CLASS</label>
                <input type="text" name="type_class" value="{{ filters.type_class }}" class="input w-full bg-slate-950/50 border-slate-800 text-cyan-100 placeholder:text-slate-600 focus:border-cyan-500/50" placeholder="Filter by type or class...">
            </div>
        {% endset %}
        {% include 'components/index_filters.html.twig' with {
            form_id: 'asset-filters',
            action: path('app_asset_index'),
            legend: 'Asset search',
            grid_class: is_categorical ? 'md:grid-cols-3' : 'md:grid-cols-4',
            fields: filter_fields,
            reset_path: path('app_asset_index', is_categorical ? { category: active_category, view: 'categorical' } : {}),
            is_filtered: filters.campaign or filters.name or filters.type_class or (not is_categorical and filters.category)
        } %}

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
            {% if assets|length > 0 %}
                {% for asset in assets %}
                    <twig:TacticalCard :asset="asset" />
                {% endfor %}
            {% else %}
                <div class="col-span-full py-12 text-center rounded-xl border border-dashed border-slate-700 bg-slate-900/50 flex flex-col items-center justify-center">
                    <p class="text-slate-500 font-rajdhani tracking-widest uppercase mb-6 text-sm">Registry is empty // No assets detected</p>
                    {% set category = app.request.query.get('category') %}
                    
                    <div class="flex flex-wrap justify-center gap-4">
                        {% if category %}
                            {# Single Category View #}
                            {% set icon = 'icons/assets.html.twig' %}
                            {% set btn_class = 'btn btn-primary btn-sm btn-outline gap-2' %}
                            
                            {% if category == 'ship' %}
                                {% set icon = 'icons/far-trader.html.twig' %}
                                {% set btn_class = 'btn btn-outline btn-primary btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' %}
                            {% elseif category == 'base' %}
                                {% set icon = 'icons/spaceport.html.twig' %}
                                {% set btn_class = 'btn btn-outline btn-warning btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' %}
                            {% elseif category == 'team' %}
                                {% set icon = 'icons/team.html.twig' %}
                                {% set btn_class = 'btn btn-outline btn-success btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' %}
                            {% endif %}
    
                            {{ tooltip.link('Launch a new asset',
                                            'Initialize ' ~ category|capitalize,
                                            icon,
                                            path('app_asset_new', { category: category }),
                                            { position: 'tooltip-center', dim: 20, linkClass: btn_class }) }}
                        {% else %}
                            {# Global View: Show all options #}
                             {{ tooltip.link('Launch a new vessel',
                                            'Add Ship',
                                            'icons/far-trader.html.twig',
                                            path('app_asset_new', { category: 'ship' }),
                                            { position: 'tooltip-bottom', dim: 20, linkClass: 'btn btn-outline btn-primary btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' }) }}

                             {{ tooltip.link('Establish a new station',
                                            'Add Base',
                                            'icons/spaceport.html.twig',
                                            path('app_asset_new', { category: 'base' }),
                                            { position: 'tooltip-bottom', dim: 20, linkClass: 'btn btn-outline btn-warning btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' }) }}

                             {{ tooltip.link('Register a tactical unit',
                                            'Add Team',
                                            'icons/team.html.twig',
                                            path('app_asset_new', { category: 'team' }),
                                            { position: 'tooltip-bottom', dim: 20, linkClass: 'btn btn-outline btn-success btn-sm gap-2 font-orbitron text-[10px] tracking-widest uppercase' }) }}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>

            {% include 'components/pagination.html.twig' with {
                pagination: pagination,
                route: 'app_asset_index',
                query: app.request.query.all
            } %}

    </div>

{% endblock %}
