{% import _self as detailsMacros %}

{% macro render_item(child) %}
    <div class="grid grid-cols-12 gap-2 border border-slate-800 bg-slate-950/40 rounded-lg p-2 relative group hover:border-cyan-500/30 transition-colors items-center collection-item">
        <button type="button"
                class="absolute -right-2 -top-2 w-5 h-5 rounded-full bg-slate-800 border border-slate-700 text-slate-400 hover:text-red-400 hover:border-red-500/50 flex items-center justify-center transition-all shadow-lg z-10 text-xs"
                data-action="asset-details#removeItem">&times;</button>
        
        <div class="col-span-8 md:col-span-6">
            {{ form_widget(child.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800 focus:border-cyan-500/50', placeholder: 'Description/Model' } }) }}
        </div>
        <div class="col-span-2 md:col-span-3">
             <div class="flex items-center gap-1">
                 <span class="text-[9px] text-slate-600 font-mono">T:</span>
                {{ form_widget(child.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800 text-right', placeholder: '0' } }) }}
             </div>
        </div>
        <div class="col-span-2 md:col-span-3">
             <div class="flex items-center gap-1">
                <span class="text-[9px] text-slate-600 font-mono">Cr:</span>
                {{ form_widget(child.costMcr, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800 text-right', placeholder: '0' } }) }}
             </div>
        </div>
    </div>
{% endmacro %}

{% macro render_collection(collection, title, color = 'slate') %}
    <div class="col-span-2 border border-slate-800 bg-slate-900/20 rounded-lg p-3" data-asset-details-target="collection">
        <div class="flex items-center justify-between mb-3 border-b border-slate-800 pb-2">
            <h4 class="text-[10px] uppercase tracking-widest font-orbitron font-bold text-{{ color }}-500/70">{{ title }}</h4>
            <button type="button" class="btn btn-outline btn-xs font-orbitron uppercase tracking-widest text-[9px] h-6 min-h-0 px-2 btn-{{ color }}"
                    data-action="asset-details#addItem">+ Add</button>
        </div>
        <div class="space-y-2" data-asset-details-target="list">
            {% for child in collection %}
                {{ _self.render_item(child) }}
            {% endfor %}
        </div>
        <template data-asset-details-target="prototype">
            {{ _self.render_item(collection.vars.prototype) }}
        </template>
    </div>
{% endmacro %}

<fieldset class="grid grid-cols-2 bg-slate-900/40 border border-slate-800 gap-6 p-6 rounded-xl shadow-inner mb-6 relative"
          data-controller="asset-details">
    <legend class="px-3 py-1 rounded bg-slate-800 border border-slate-700 text-[10px] font-bold font-orbitron tracking-[0.3em] text-cyan-500/80 uppercase">Ship Specifications</legend>
    
    <div class="col-span-2">
        <div class="alert alert-info alert-outline border-cyan-500/50 bg-cyan-950/30 mb-6">
            <div class="flex items-center gap-3">
                 <div class="text-cyan-500">
                    {% include 'icons/ship-components.html.twig' %}
                </div>
                <div>
                     <div class="text-[10px] font-rajdhani uppercase tracking-widest font-bold text-cyan-500 mb-1">
                        Core Components Registry
                   </div>
                   <div class="text-sm text-cyan-100 font-light">
                        Verified specifications. Tech Level and Total Cost are summarized here.
                   </div>
                </div>
            </div>
        </div>
    </div>

    {# Top Bar: Tech Level & Total Cost #}
    <div class="col-span-2 grid grid-cols-2 gap-4 mb-2">
        <div>
             {{ form_label(form.techLevel, null, { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
             {{ form_widget(form.techLevel, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800 focus:border-cyan-500/50' } }) }}
        </div>
        <div>
             {{ form_label(form.totalCost, null, { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
             <div class="join w-full">
                 {{ form_widget(form.totalCost, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800 focus:border-cyan-500/50 font-mono text-cyan-400 join-item' } }) }}
                 <button type="button" class="btn btn-sm btn-outline btn-cyan join-item" data-action="asset-details#calculateTotal">Auto-Sum</button>
             </div>
        </div>
    </div>

    {# Hull Section #}
    <div class="col-span-2 md:col-span-1 border border-slate-700 bg-slate-950/40 rounded-lg p-4 group hover:border-cyan-500/30 transition-colors">
        <div class="flex items-center gap-2 mb-3 border-b border-slate-800 pb-2">
            <span class="text-[10px] uppercase tracking-widest font-orbitron font-bold text-cyan-500/70">{{ form.hull.vars.label }}</span>
        </div>
        <div class="grid grid-cols-1 gap-3">
             <div>
                {{ form_label(form.hull.description, 'Description', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                {{ form_widget(form.hull.description, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
            </div>
             <div class="grid grid-cols-2 gap-3">
                 <div>
                    {{ form_label(form.hull.configuration, 'Config Class', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                    {{ form_widget(form.hull.configuration, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
                </div>
                 <div>
                    {{ form_label(form.hull.tons, 'Tonnage', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                    {{ form_widget(form.hull.tons, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3">
                 <div>
                    {{ form_label(form.hull.points, 'Struct. Points', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                    {{ form_widget(form.hull.points, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
                </div>
                <div>
                     {{ form_label(form.hull.costMcr, 'Cost (MCr)', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                    {{ form_widget(form.hull.costMcr, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800' } }) }}
                </div>
            </div>
        </div>
    </div>

    {# Drives Section #}
    <div class="col-span-2 md:col-span-1 border border-slate-700 bg-slate-950/40 rounded-lg p-4 group hover:border-cyan-500/30 transition-colors">
        <div class="flex items-center gap-2 mb-3 border-b border-slate-800 pb-2">
            <span class="text-[10px] uppercase tracking-widest font-orbitron font-bold text-amber-500/70">Engineering</span>
        </div>
        
        {# J-Drive #}
        {% if form.jDrive is defined %}
        <div class="mb-4">
             <div class="text-xs font-bold text-slate-400 uppercase font-orbitron mb-1">Jump Drive</div>
             <div class="grid grid-cols-12 gap-2">
                 <div class="col-span-3">
                     {{ form_label(form.jDrive.rating, 'Rating', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.jDrive.rating, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-3">
                     {{ form_label(form.jDrive.tons, 'Tons', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.jDrive.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-3">
                     {{ form_label(form.jDrive.costMcr, 'MCr', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.jDrive.costMcr, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-12 mt-1">
                     {{ form_widget(form.jDrive.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Description/Model' } }) }}
                 </div>
             </div>
        </div>
        {% endif %}

        {# M-Drive #}
        {% if form.mDrive is defined %}
        <div class="mb-4">
             <div class="text-xs font-bold text-slate-400 uppercase font-orbitron mb-1">Maneuver Drive</div>
             <div class="grid grid-cols-12 gap-2">
                 <div class="col-span-3">
                     {{ form_label(form.mDrive.rating, 'Rating', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.mDrive.rating, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-3">
                     {{ form_label(form.mDrive.tons, 'Tons', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.mDrive.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-3">
                     {{ form_label(form.mDrive.costMcr, 'MCr', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.mDrive.costMcr, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-12 mt-1">
                     {{ form_widget(form.mDrive.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Description/Model' } }) }}
                 </div>
             </div>
        </div>
        {% endif %}

        {# Power Plant #}
        <div>
             <div class="text-xs font-bold text-slate-400 uppercase font-orbitron mb-1">Power Plant</div>
             <div class="grid grid-cols-12 gap-2">
                 <div class="col-span-3">
                     {{ form_label(form.powerPlant.rating, 'Output', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.powerPlant.rating, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-3">
                     {{ form_label(form.powerPlant.tons, 'Tons', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.powerPlant.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-3">
                     {{ form_label(form.powerPlant.costMcr, 'MCr', { label_attr: { class: 'block mb-1 text-[9px] uppercase text-slate-500' } }) }}
                     {{ form_widget(form.powerPlant.costMcr, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800' } }) }}
                 </div>
                 <div class="col-span-12 mt-1">
                     {{ form_widget(form.powerPlant.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Description/Model' } }) }}
                 </div>
             </div>
        </div>
    </div>

    {# Fuel Section #}
    {% if form.fuel is defined %}
    <div class="col-span-2 border border-slate-700 bg-slate-950/40 rounded-lg p-4 group hover:border-cyan-500/30 transition-colors">
         <div class="flex items-center gap-2 mb-3 border-b border-slate-800 pb-2">
            <span class="text-[10px] uppercase tracking-widest font-orbitron font-bold text-emerald-500/70">Fuel Systems</span>
        </div>
        <div class="flex items-end gap-4">
             <div class="w-1/4">
                 {{ form_label(form.fuel.tons, 'Capacity (Tons)', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                {{ form_widget(form.fuel.tons, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800 focus:border-cyan-500/50' } }) }}
            </div>
            <div class="flex-1">
                 {{ form_label(form.fuel.description, 'Notes', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                {{ form_widget(form.fuel.description, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800 focus:border-cyan-500/50' } }) }}
            </div>
             <div class="w-1/6">
                 {{ form_label(form.fuel.costMcr, 'Cost (MCr)', { label_attr: { class: 'mb-1 text-slate-400 text-[10px] uppercase tracking-widest font-bold font-orbitron' } }) }}
                {{ form_widget(form.fuel.costMcr, { attr: { class: 'input input-bordered input-sm w-full bg-slate-950/50 border-slate-800 focus:border-cyan-500/50' } }) }}
            </div>
        </div>
    </div>
    {% endif %}

    {# Operational Section #}
    <div class="col-span-2 md:col-span-1 border border-slate-700 bg-slate-950/40 rounded-lg p-4 group hover:border-cyan-500/30 transition-colors">
        <div class="flex items-center gap-2 mb-3 border-b border-slate-800 pb-2">
            <span class="text-[10px] uppercase tracking-widest font-orbitron font-bold text-cyan-500/70">Operational & bridge</span>
        </div>
        <div class="space-y-4">
            {# Bridge #}
            <div>
                 <div class="text-xs font-bold text-slate-400 uppercase font-orbitron mb-1">{{ form.bridge.vars.label }}</div>
                 <div class="grid grid-cols-12 gap-2">
                     <div class="col-span-8">
                         {{ form_widget(form.bridge.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Type' } }) }}
                     </div>
                     <div class="col-span-2">
                         {{ form_widget(form.bridge.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Tons' } }) }}
                     </div>
                     <div class="col-span-2">
                         {{ form_widget(form.bridge.costMcr, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'MCr' } }) }}
                     </div>
                 </div>
            </div>
            {# Computer #}
            <div>
                 <div class="text-xs font-bold text-slate-400 uppercase font-orbitron mb-1">Computer</div>
                 <div class="grid grid-cols-12 gap-2">
                     <div class="col-span-8">
                         {{ form_widget(form.computer.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Model/Rat' } }) }}
                     </div>
                     <div class="col-span-2">
                         {{ form_widget(form.computer.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Tons' } }) }}
                     </div>
                     <div class="col-span-2">
                         {{ form_widget(form.computer.costMcr, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'MCr' } }) }}
                     </div>
                 </div>
            </div>
             {# Sensors #}
            <div>
                 <div class="text-xs font-bold text-slate-400 uppercase font-orbitron mb-1">Sensors</div>
                 <div class="grid grid-cols-12 gap-2">
                     <div class="col-span-8">
                         {{ form_widget(form.sensors.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Type/DM' } }) }}
                     </div>
                     <div class="col-span-2">
                         {{ form_widget(form.sensors.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Tons' } }) }}
                     </div>
                     <div class="col-span-2">
                         {{ form_widget(form.sensors.costMcr, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'MCr' } }) }}
                     </div>
                 </div>
            </div>
             {# Software Collection #}
            {{ detailsMacros.render_collection(form.software, 'Software', 'cyan') }}
        </div>
    </div>


    {# Accommodation & Cargo #}
    <div class="col-span-2 md:col-span-1 border border-slate-700 bg-slate-950/40 rounded-lg p-4 group hover:border-cyan-500/30 transition-colors">
        <div class="flex items-center gap-2 mb-3 border-b border-slate-800 pb-2">
            <span class="text-[10px] uppercase tracking-widest font-orbitron font-bold text-emerald-500/70">Payload & Accommodation</span>
        </div>
        
         <div class="space-y-4">
             {# Cargo #}
            <div>
                 <div class="text-xs font-bold text-slate-400 uppercase font-orbitron mb-1">{{ form.cargo.vars.label }}</div>
                 <div class="grid grid-cols-12 gap-2">
                     <div class="col-span-8">
                         {{ form_widget(form.cargo.description, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Main Hold' } }) }}
                     </div>
                     <div class="col-span-2">
                         {{ form_widget(form.cargo.tons, { attr: { class: 'input input-bordered input-xs w-full bg-slate-950/50 border-slate-800', placeholder: 'Tons' } }) }}
                     </div>
                     <div class="col-span-2"></div>
                 </div>
            </div>

             {# Staterooms Collection #}
             {{ detailsMacros.render_collection(form.staterooms, 'Staterooms / Berths', 'emerald') }}
             
             {# Common Areas Collection #}
             {{ detailsMacros.render_collection(form.commonAreas, 'Common Areas', 'emerald') }}
         </div>
    </div>

    {# Systems & Weapons #}
    <div class="col-span-2 grid grid-cols-2 gap-4">
        {{ detailsMacros.render_collection(form.weapons, 'Hardpoints & Weapons', 'red') }}
        {{ detailsMacros.render_collection(form.systems, 'Systems & Equipment', 'amber') }}
    </div>

    {# Craft #}
    <div class="col-span-2">
        {{ detailsMacros.render_collection(form.craft, 'Craft & Vehicles', 'purple') }}
    </div>

</fieldset>
