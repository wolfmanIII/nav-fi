<!DOCTYPE html>
<html data-theme="abyss" lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{% block title %}Nav-Fi&sup3;{% endblock %}</title>
    
    <link rel="icon" href="{{ asset('img/favicon.ico') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ asset('img/favicon-16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ asset('img/favicon-32.png') }}">
    <link rel="icon" type="image/png" sizes="48x48" href="{{ asset('img/favicon-48.png') }}">
    <link rel="icon" type="image/png" sizes="64x64" href="{{ asset('img/favicon-64.png') }}">
    <link rel="icon" type="image/png" sizes="128x128" href="{{ asset('img/favicon-128.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ asset('img/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ asset('img/android-chrome-192.png') }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ asset('img/android-chrome-512.png') }}">
    <link rel="shortcut icon" href="{{ asset('img/favicon.ico') }}">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">

    {% block stylesheets %}
    {% endblock %}

    {% block javascripts %}
        <script src="{{ asset('vendor/highlightjs/highlight.min.js') }}" defer></script>
        {% block importmap %}{{ importmap('app') }}{% endblock %}
    {% endblock %}
</head>
<body class="text-slate-300">

    <div class="drawer lg:drawer-open">
        <input id="my-drawer-4" type="checkbox" class="drawer-toggle"/>

        <!-- CONTENUTO PAGINA -->
        <div class="drawer-content flex flex-col min-h-screen {% block layout_class %}{% endblock %}">
            <nav class="navbar w-full sticky top-0 z-30 bg-slate-950/80 backdrop-blur-md border-b border-cyan-500/20 shadow-[0_8px_32px_rgba(0,0,0,0.4)] px-4">
                <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent opacity-50"></div>
                
                <!-- BOOT SEQUENCE // CONNECTIVITY -->
                <div class="hidden xl:flex absolute left-1/2 -translate-x-1/2 top-0 h-1 px-4 gap-1">
                    <div class="w-8 h-full bg-cyan-500/20 rounded-b animate-pulse"></div>
                    <div class="w-12 h-full bg-cyan-500/40 rounded-b animate-pulse"></div>
                    <div class="w-8 h-full bg-cyan-500/20 rounded-b animate-pulse"></div>
                </div>

                <!-- MOBILE TOGGLE -->
                <div class="flex-none lg:hidden">
                    <label for="my-drawer-4"
                           aria-label="open sidebar"
                           class="btn btn-square btn-ghost text-cyan-400 hover:bg-cyan-500/10">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke="currentColor" class="size-6">
                            <path d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </label>
                </div>

                <!-- BRANDING // TELEMETRY -->
                <div class="flex items-center gap-4">
                    <div class="relative group">
                        <div class="absolute -inset-1 bg-cyan-500/20 rounded-lg blur opacity-0 group-hover:opacity-100 transition duration-500"></div>
                        <img src="{{ asset('img/nav-fi-logo.png') }}" class="relative w-12 md:w-16 h-auto filter drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]" alt="logo">
                    </div>
                    <div class="flex flex-col">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl md:text-3xl font-orbitron font-bold tracking-tight text-white italic">Nav-Fi &sup3;</span>
                            <div class="hidden lg:flex items-center gap-2 px-3 rounded-md bg-cyan-500/10 border border-cyan-500/30 ml-2">
                                <div class="flex gap-1">
                                    <div class="w-1 h-1 rounded-full bg-cyan-500 animate-pulse"></div>
                                    <div class="w-1 h-1 rounded-full bg-cyan-400 animate-pulse" style="animation-delay: 0.2s;"></div>
                                    <div class="w-1 h-1 rounded-full bg-cyan-500 animate-pulse" style="animation-delay: 0.4s;"></div>
                                </div>
                                <span class="text-[10px] font-rajdhani uppercase tracking-[0.2em] text-cyan-400 font-bold">CENTRAL INTERFACE</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-[11px] font-mono text-cyan-500/60 uppercase tracking-[0.2em] font-bold">
                            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                            OPEN SYSTEMS // NAV-COMPUTER
                        </div>
                    </div>
                </div>

                <div class="flex-1 px-4 flex justify-center lg:justify-end lg:mr-4">
                    {% if asset is defined and asset.financialAccount is defined %}
                        <div class="hidden md:flex items-center gap-4 px-4 py-1.5 rounded-full bg-slate-900/60 border border-slate-700/50 shadow-inner">
                            <div class="flex items-center gap-2">
                                {% if asset.category == 'ship' %}
                                    {% include 'icons/far-trader.html.twig' with { dim: 16 } %}
                                {% elseif asset.category == 'base' %}
                                    {% include 'icons/spaceport.html.twig' with { dim: 16 } %}
                                {% elseif asset.category == 'team' %}
                                    {% include 'icons/team.html.twig' with { dim: 16 } %}
                                {% else %}
                                    {% include 'icons/assets.html.twig' with { dim: 16 } %}
                                {% endif %}
                                <span class="text-xs font-bold font-orbitron text-cyan-100 uppercase tracking-widest">{{ asset.name }}</span>
                            </div>
                            <div class="h-4 w-[1px] bg-slate-700"></div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Credits</span>
                                    {% set credits = asset.financialAccount ? asset.financialAccount.credits : 0 %}
                                    <span class="text-sm font-mono font-bold {{ credits < 0 ? 'text-rose-400' : 'text-emerald-400' }}">
                                        {{ credits|format_number({ min_fraction_digit: 0, max_fraction_digit: 0, grouping_used: true }, 'decimal', 'default', app.request.locale) }}
                                        <span class="text-[10px] text-slate-600">Cr</span>
                                    </span>
                                </div>
                            
                            {% if asset.campaign and asset.campaign.sessionDay and asset.campaign.sessionYear %}
                                <div class="h-4 w-[1px] bg-slate-700"></div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Date</span>
                                    <span class="text-sm font-mono font-bold text-cyan-100">
                                        {{ asset.campaign.sessionDay|imperial_date(asset.campaign.sessionYear) }}
                                    </span>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>

                <!-- USER HUD // AUTHENTICATION -->
                <div class="flex-none">
                    {% if app.user %}
                        <div class="flex items-center gap-4 bg-slate-900/40 border border-slate-800 rounded-full pl-1.5 pr-5 py-1.5 hover:border-cyan-500/30 transition-colors">
                            <div class="relative">
                                <img src="{{ app.user.gravatarUrl(48) }}"
                                     alt="avatar"
                                     class="w-10 h-10 rounded-full border border-cyan-500/40 shadow-[0_0_15px_rgba(6,182,212,0.4)]">
                                <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-emerald-500 border-2 border-slate-950 rounded-full"></div>
                            </div>
                            
                            <div class="hidden md:flex flex-col items-start leading-none gap-1">
                                <span class="text-xs md:text-sm font-mono font-bold text-cyan-100 uppercase tracking-widest">{{ app.user.userIdentifier }}</span>
                                <div class="flex items-center gap-1.5">
                                    {% if is_granted('ROLE_SUPER_ADMIN') %}
                                        <span class="text-[10px] font-mono font-bold text-rose-500 uppercase tracking-tighter bg-rose-500/10 px-2 py-0.5 border border-rose-500/20">OVERRIDE_AUTH</span>
                                    {% elseif is_granted('ROLE_ADMIN') %}
                                        <span class="text-[10px] font-mono font-bold text-amber-500 uppercase tracking-tighter bg-amber-500/10 px-2 py-0.5 border border-amber-500/20">ELEVATED_AUTH</span>
                                    {% else %}
                                        <span class="text-[10px] font-mono font-bold text-cyan-500 uppercase tracking-tighter bg-cyan-500/10 px-2 py-0.5 border border-cyan-500/20">STAND_USER</span>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="w-[1px] h-8 bg-slate-800 mx-1"></div>

                            <form method="post" action="{{ path('app_logout') }}">
                                <button class="group flex items-center gap-2.5 px-2.5 py-1.5 rounded-md hover:bg-rose-500/10 transition-all">
                                    <span class="hidden sm:inline text-[11px] font-orbitron font-bold text-slate-500 group-hover:text-rose-400 tracking-widest uppercase transition-colors">Eject</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="text-slate-500 group-hover:text-rose-500 transition-colors">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                                    </svg>
                                </button>
                            </form>
                        </div>
                    {% else %}
                        <a href="{{ path('app_login') }}" class="btn btn-outline border-cyan-500/40 text-cyan-400 font-orbitron uppercase tracking-widest text-[11px] hover:bg-cyan-500/10 hover:border-cyan-400 px-6">
                            Establish Link // Login
                        </a>
                    {% endif %}
                </div>
            </nav>

            <div class="p-6">
                <div class="w-full">
                    <div class="flex flex-col items-stretch gap-4">
                        {% for label, messages in app.flashes %}
                            {% for message in messages %}
                                {% set alertClass = 'border-l-4 border-cyan-500 bg-cyan-950/40 text-cyan-100 shadow-[0_0_15px_rgba(6,182,212,0.1)]' %}
                                {% set iconDim = 24 %}
                                {% if label == 'success' %}
                                    {% set alertClass = 'border-l-4 border-emerald-500 bg-emerald-950/40 text-emerald-100 shadow-[0_0_15px_rgba(16,185,129,0.1)]' %}
                                {% elseif label == 'error' or label == 'danger' %}
                                    {% set alertClass = 'border-l-4 border-rose-500 bg-rose-950/40 text-rose-100 shadow-[0_0_15px_rgba(244,63,94,0.1)]' %}
                                {% elseif label == 'warning' %}
                                    {% set alertClass = 'border-l-4 border-amber-500 bg-amber-950/40 text-amber-100 shadow-[0_0_15px_rgba(245,158,11,0.1)]' %}
                                {% endif %}
                                
                                <div role="alert" class="alert mb-4 {{ alertClass }} rounded-r-lg rounded-tl-none rounded-bl-none border-t-0 border-b-0 border-r-0 flex items-start gap-4 backdrop-blur-md">
                                    <div class="animate-spin-slow text-current pt-1">
                                        {% include 'icons/radar.html.twig' with { dim: iconDim } %}
                                    </div>
                                    <div class="font-rajdhani uppercase tracking-wide font-semibold text-sm pt-0.5">{{ message|raw }}</div>
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>

                    {% block pageContent %}{% endblock %}
                </div>
            </div>

            <footer class="mt-auto relative overflow-hidden bg-slate-950/80 backdrop-blur-md border-t border-cyan-500/20 py-8 px-6">
                <div class="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent opacity-50"></div>
                
                <div class="relative flex flex-col md:flex-row items-center justify-between gap-6 max-w-7xl mx-auto">
                    <!-- LOGO // SIGNAL -->
                    <div class="flex items-center gap-4">
                        <div class="relative">
                            <div class="absolute -inset-1 bg-cyan-500/20 rounded-full blur opacity-50 animate-pulse"></div>
                            {% include 'icons/radar.html.twig' with { dim: 20, class: 'relative text-cyan-400 opacity-80 animate-spin-slow' } %}
                        </div>
                        <div class="flex flex-col">
                            <span class="text-[10px] font-orbitron font-bold tracking-[0.4em] text-cyan-500/60 uppercase">Nav-Fi&sup3; Interface</span>
                            <span class="text-xs font-rajdhani font-medium tracking-widest text-slate-400 capitalize">Imperial standard drift lane // Protocol 7.4</span>
                        </div>
                    </div>

                    <!-- TELEMETRY // DATA -->
                    <div class="hidden lg:flex items-center gap-8">
                        <div class="flex flex-col items-end">
                            <span class="text-[9px] font-mono text-slate-500 uppercase tracking-tighter">System Status</span>
                            <div class="flex items-center gap-2">
                                <span class="w-1.5 h-1.5 rounded-full bg-emerald-500/80 shadow-[0_0_8px_rgba(16,185,129,0.5)] animate-pulse"></span>
                                <span class="text-xs font-mono text-emerald-400/80 font-bold uppercase tracking-widest">Active Link</span>
                            </div>
                        </div>
                        <div class="w-px h-8 bg-slate-800"></div>
                        <div class="flex flex-col items-end">
                            <span class="text-[9px] font-mono text-slate-500 uppercase tracking-tighter">Data Synchronization</span>
                            <div class="flex items-center gap-2 font-mono text-xs text-cyan-400/80">
                                <span class="animate-pulse">_</span>
                                <span>SYNC_COMPLETE</span>
                            </div>
                        </div>
                    </div>

                    <!-- COPYRIGHT // SIGNATURE -->
                    <div class="text-center md:text-right">
                        <p class="text-[10px] font-orbitron font-bold tracking-[0.2em] text-cyan-300/40 uppercase mb-1">
                            &copy; {{ "now"|date("Y") }} Nav-Fi&sup3; Open Systems | Certified TAS Peripheral
                        </p>
                        <div class="flex items-center justify-center md:justify-end gap-3 text-[9px] font-bold font-rajdhani text-slate-600 uppercase tracking-[0.3em]">
                            <span>Restricted Access</span>
                            <span class="w-1 h-1 rounded-full bg-slate-700"></span>
                            <span>Level 4 Clearence Required</span>
                        </div>
                    </div>
                </div>

                <!-- BOTTOM LINE -->
                <div class="mt-8 flex items-center justify-center gap-4 opacity-20">
                    <div class="h-[1px] flex-1 bg-gradient-to-r from-transparent to-cyan-500/50"></div>
                    <div class="flex gap-1.5">
                        <div class="w-1 h-1 bg-cyan-500 rotate-45"></div>
                        <div class="w-1 h-1 bg-cyan-400 rotate-45"></div>
                        <div class="w-1 h-1 bg-cyan-500 rotate-45"></div>
                    </div>
                    <div class="h-[1px] flex-1 bg-gradient-to-l from-transparent to-cyan-500/50"></div>
                </div>
            </footer>

        </div>

        <!-- SIDEBAR -->
        {% include '_sidebar.html.twig' %}
    </div>

</body>
</html>
