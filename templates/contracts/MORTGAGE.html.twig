{% extends 'base_plain.html.twig' %}

{% block title %}Ship Mortgage Agreement{% endblock %}
{% block stylesheets %}{% endblock %}
{% block javascripts %}{% endblock %}

{% block pageContent %}
    {% set summary = mortgage.calculate() %}

    <div class="flex items-center justify-between mb-4">
        <div>
            <h1 class="text-2xl font-bold">Ship Mortgage Agreement</h1>
            <p class="text-sm opacity-70">Code: {{ mortgage.code }}{% if mortgage.signed %} • Signed{% endif %}</p>
        </div>
        <div class="text-right text-sm opacity-80">
            <div>Generated for: {{ user.userIdentifier }}</div>
            {% if mortgage.company %}
                <div>Counterparty: {{ mortgage.company.name }} ({{ mortgage.company.companyRole.code }})</div>
            {% endif %}
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="card bg-base-200 border border-base-300 shadow-sm">
            <div class="card-body p-4">
                <h2 class="card-title text-lg mb-2">Vessel</h2>
                <p><b>Name:</b> {{ ship.name }}</p>
                <p><b>Type / Class:</b> {{ ship.type }} / {{ ship.class }}</p>
                <p><b>Price:</b> {{ ship.price|number_format(2, ',', '.') }} Cr</p>
            </div>
        </div>

        <div class="card bg-base-200 border border-base-300 shadow-sm">
            <div class="card-body p-4">
                <h2 class="card-title text-lg mb-2">Counterparty</h2>
                {% if mortgage.company %}
                    <p><b>Name:</b> {{ mortgage.company.name }}</p>
                    <p><b>Role:</b> {{ mortgage.company.companyRole.description }} ({{ mortgage.company.companyRole.code }})</p>
                    <p><b>Contact:</b> {{ mortgage.company.contact ?? '—' }}</p>
                    <p><b>Sign label:</b> {{ mortgage.company.signLabel ?? '—' }}</p>
                {% else %}
                    <p>Not specified</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="card bg-base-200 border border-base-300 shadow-sm mb-4">
        <div class="card-body p-4">
            <h2 class="card-title text-lg mb-2">Terms</h2>
            <div class="grid grid-cols-2 gap-3 text-sm">
                <div><b>Start Day/Year:</b> {{ mortgage.startDay }}/{{ mortgage.startYear }}</div>
                <div><b>Ship Shares:</b> {{ mortgage.shipShares ?? 0 }}</div>
                <div><b>Advance Payment:</b> {{ mortgage.advancePayment|number_format(2, ',', '.') }} Cr</div>
                <div><b>Discount:</b> {{ mortgage.discount ?? 0 }} %</div>
                <div><b>Interest:</b>
                    {{ mortgage.interestRate.duration }} years,
                    x{{ mortgage.interestRate.priceMultiplier }}/{{ mortgage.interestRate.priceDivider }},
                    {{ mortgage.interestRate.annualInterestRate }}% annual
                </div>
                <div><b>Insurance:</b>
                    {% if mortgage.insurance %}
                        {{ mortgage.insurance.name }} ({{ mortgage.insurance.annualCost }}% ship price)
                    {% else %}
                        None
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="card bg-base-200 border border-base-300 shadow-sm mb-4">
        <div class="card-body p-4">
            <h2 class="card-title text-lg mb-3">Financial summary</h2>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div><b>Ship cost (after shares/advance/discount):</b></div>
                <div class="text-right">{{ summary.ship_cost|number_format(2, ',', '.') }} Cr</div>

                <div><b>Mortgage monthly:</b></div>
                <div class="text-right">{{ summary.mortgage_monthly|number_format(2, ',', '.') }} Cr</div>

                <div><b>Mortgage annual:</b></div>
                <div class="text-right">{{ summary.mortgage_annual|number_format(2, ',', '.') }} Cr</div>

                <div><b>Insurance monthly:</b></div>
                <div class="text-right">{{ summary.insurance_monthly|number_format(2, ',', '.') }} Cr</div>

                <div><b>Insurance annual:</b></div>
                <div class="text-right">{{ summary.insurance_annual|number_format(2, ',', '.') }} Cr</div>

                <div><b>Total monthly payment:</b></div>
                <div class="text-right">{{ summary.total_monthly_payment|number_format(2, ',', '.') }} Cr</div>

                <div><b>Total annual payment:</b></div>
                <div class="text-right">{{ summary.total_annual_payment|number_format(2, ',', '.') }} Cr</div>

                <div><b>Total mortgage amount:</b></div>
                <div class="text-right">{{ summary.total_mortgage|number_format(2, ',', '.') }} Cr</div>
            </div>
            <p class="text-xs opacity-70 mt-3">Installments already paid are not listed in this document.</p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-8 mt-6 text-sm">
        <div class="border-t border-base-300 pt-2">
            <div><b>Owner / Operator</b></div>
            <div>{{ user.userIdentifier }}</div>
        </div>
        <div class="border-t border-base-300 pt-2">
            <div><b>Counterparty</b></div>
            {% if mortgage.company %}
                <div>{{ mortgage.company.signLabel ?? mortgage.company.name }}</div>
            {% else %}
                <div>_____________________</div>
            {% endif %}
        </div>
    </div>
{% endblock %}
