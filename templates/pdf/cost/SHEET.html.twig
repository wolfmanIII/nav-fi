{% extends 'base_plain.html.twig' %}

{% block title %}Cost Sheet{% endblock %}

{% block stylesheets %}
    <style>
        /* Printer-friendly styles - Minimized ink usage */
        body { 
            font-family: 'Inter', 'Segoe UI', sans-serif; 
            font-size: 10px; 
            color: #1f2937; 
            background: #ffffff; 
        }
        
        .page { padding: 12px; }
        
        /* Header table - White background */
        .header-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 10px;
            background: #ffffff;
        }
        
        .header-table td { vertical-align: middle; }
        
        .logo { height: 64px; }
        
        .subtitle { 
            font-size: 10px; 
            text-transform: uppercase; 
            letter-spacing: 0.18em; 
            color: #6b7280; 
            margin: 0; 
            text-align: right; 
        }
        
        .title { 
            font-size: 16px; 
            font-weight: 700; 
            margin: 2px 0 0 0; 
            color: #1f2937; 
            text-align: right; 
        }
        
        /* Card - Very light background */
        .card { 
            background: #f9fafb; 
            border: 1px solid #e5e7eb; 
            border-radius: 6px; 
            padding: 12px; 
            margin-bottom: 10px; 
            page-break-inside: avoid; 
            break-inside: avoid; 
        }
        
        .section-title { 
            font-size: 11px; 
            font-weight: 700; 
            margin: 0 0 8px 0; 
            color: #374151; 
            text-transform: uppercase; 
            letter-spacing: 0.06em; 
        }
        
        .grid { display: grid; gap: 8px; }
        .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        
        /* Tables - White background, thin borders */
        .table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 9px;
            background: #ffffff;
        }
        
        .table th, 
        .table td { 
            border: 1px solid #d1d5db; 
            padding: 6px; 
            vertical-align: top; 
        }
        
        .table th { 
            background: #f3f4f6; 
            text-align: left;
            font-weight: 600;
            color: #374151;
        }
        
        .table td {
            color: #1f2937;
        }
        
        /* Alternate row colors */
        .table tbody tr:nth-child(even) {
            background: #f9fafb;
        }
        
        .muted { color: #6b7280; font-size: 9px; }
        .val { font-weight: 600; color: #1f2937; }
    </style>
{% endblock %}
{% block javascripts %}{% endblock %}

{% block pageContent %}
    {% set locale = locale ?? 'en' %}
    <div class="page">
        <table class="header-table">
            <tr>
                <td style="text-align: left;">
                    <img src="{{ absolute_url(asset('img/nav-fi-logo.png')) }}" alt="Nav-Fi" class="logo">
                </td>
                <td style="text-align: right;">
                    <p class="subtitle">Disbursement docket</p>
                    <p class="title">Payable statement</p>
                    <p class="muted" style="margin: 4px 0 0 0;">
                        Docket ref: {{ cost.code }} |
                        {{ (cost.paymentDay is not null and cost.paymentYear is not null) ? (cost.paymentDay|imperial_date(cost.paymentYear)) : '—' }}
                    </p>
                    <p class="muted" style="margin: 2px 0 0 0;">
                        Template: {{ template_version('pdf/cost/SHEET.html.twig') }}
                    </p>
                </td>
            </tr>
        </table>

        <div class="card grid grid-2">
            <div>
                <div class="muted">Title</div>
                <div class="val">{{ cost.title }}</div>
            </div>
            <div>
                <div class="muted">Category</div>
                <div class="val">{{ cost.costCategory ? cost.costCategory.description : '—' }}</div>
            </div>
            <div>
                <div class="muted">Company</div>
                <div class="val">{{ cost.company ? cost.company.name ~ ' — ' ~ cost.company.code : '—' }}</div>
            </div>
            <div>
                <div class="muted">Ship</div>
                <div class="val">{{ cost.ship ? cost.ship.name ~ ' — ' ~ cost.ship.type ~ ' — ' ~ cost.ship.class : '—' }}</div>
            </div>
        </div>

        {% if cost.localLaw %}
            <div class="card">
                <div class="section-title">Local Law</div>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Short Reference</th>
                        <th>Legal Basis / Article</th>
                        <th>Mandatory Disclaimer</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{ cost.localLaw.shortDescription ?? '—' }}</td>
                        <td>{{ cost.localLaw.description ?? '—' }}</td>
                        <td>{{ cost.localLaw.disclaimer ?? '—' }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        {% endif %}

        <div class="card">
            <div class="section-title">Line-item register</div>
            <table class="table">
                <thead>
                <tr>
                    <th>Description</th>
                    <th style="text-align: right;">Quantity</th>
                    <th style="text-align: right;">Unit Cost (Cr)</th>
                    <th style="text-align: right;">Line Total (Cr)</th>
                </tr>
                </thead>
                <tbody>
                {% set items = cost.detailItems ?? [] %}
                {% if items|length == 0 %}
                    {% set items = [ { description: '—', quantity: null, cost: null } ] %}
                {% endif %}
                {% for item in items %}
                    {% set qty = item.quantity ?? null %}
                    {% set unit = item.cost ?? null %}
                    {% set lineTotal = (qty is not null and unit is not null) ? qty * unit : null %}
                    <tr>
                        <td>{{ item.description ?? '—' }}</td>
                        <td style="text-align: right;">{{ qty is not null ? qty|format_number({ min_fraction_digit: 0, max_fraction_digit: 2, grouping_used: true }, 'decimal', 'default', locale) : '—' }}</td>
                        <td style="text-align: right;">{{ unit is not null ? unit|format_number({ min_fraction_digit: 2, max_fraction_digit: 2, grouping_used: true }, 'decimal', 'default', locale) : '—' }}</td>
                        <td style="text-align: right;">{{ lineTotal is not null ? lineTotal|format_number({ min_fraction_digit: 2, max_fraction_digit: 2, grouping_used: true }, 'decimal', 'default', locale) : '—' }}</td>
                    </tr>
                {% endfor %}
                <tr>
                    <td colspan="3" style="text-align: right; font-weight: 700;">Total (Cr)</td>
                    <td style="text-align: right; font-weight: 700;">
                        {{ cost.amount is not null ? cost.amount|format_number({ min_fraction_digit: 2, max_fraction_digit: 2, grouping_used: true }, 'decimal', 'default', locale) : '—' }}
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        {% if cost.note %}
            <div class="card">
                <div class="section-title">Notes</div>
                <div class="muted" style="white-space: pre-line;">{{ cost.note }}</div>
            </div>
        {% endif %}
    </div>
{% endblock %}
