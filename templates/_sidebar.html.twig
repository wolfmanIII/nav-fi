<div class="drawer-side">
    <label for="my-drawer-4" aria-label="close sidebar" class="drawer-overlay"></label>

    <div class="min-h-full w-64 bg-gradient-to-b from-slate-800 via-slate-900 to-slate-950 text-cyan-100 flex flex-col items-start border-r border-cyan-500/30">
        <div class="w-full bg-gradient-to-r from-teal-600 via-slate-800 to-slate-900 text-cyan-100 flex items-center justify-center gap-2 py-2 px-3 uppercase tracking-[0.2em] border-b border-cyan-500/30 font-orbitron font-bold" style="font-size: 10px;">
            <span class="flex items-center justify-center animate-spin-slow">
                {% include 'icons/radar.html.twig' %}
            </span>
            <span>Beacon // Dock Ready</span>
        </div>

        <ul class="menu w-full grow px-2 pb-10">
            {# COMMAND MODULE #}
            <li class="menu-title mt-4">
                <span class="text-xs uppercase tracking-[0.3em] text-cyan-500 font-bold opacity-80">Command Module</span>
            </li>
            <li>
                {% set current_route = app.request.attributes.get('_route') %}
                {% set command_active = current_route in ['app_profile', 'app_home', 'app_bridge'] %}
                <details {% if command_active %}open{% endif %} data-controller="sidebar-module" data-action="toggle->sidebar-module#toggle">
                    <summary data-sidebar-module-target="summary" class="text-xs uppercase tracking-widest text-slate-400 hover:text-cyan-300 relative overflow-hidden">Bridge Console</summary>
                    <ul data-sidebar-module-target="content">
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_profile') }}"
                               class="{% if current_route == 'app_profile' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/dossier.html.twig' with {'dim': '18'} %}
                                <span>Dossier // 01</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_home') }}"
                               class="{% if current_route == 'app_home' or current_route == 'app_bridge' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/bridge-panels.html.twig' with {'dim': '18'} %}
                                <span>Bridge Control</span>
                            </a>
                        </li>
                    </ul>
                </details>
            </li>

            {# OPS MODULE #}
            <li class="menu-title mt-6">
                <span class="text-xs uppercase tracking-[0.3em] text-cyan-500 font-bold opacity-80">Operations Control</span>
            </li>
            <li>
                {% set tactical_active = current_route starts with 'app_campaign' 
                    or current_route starts with 'app_company' 
                    or current_route starts with 'app_asset' 
                    or current_route starts with 'app_crew' 
                    or current_route starts with 'app_route' %}
                <details {% if tactical_active %}open{% endif %} data-controller="sidebar-module" data-action="toggle->sidebar-module#toggle">
                    <summary data-sidebar-module-target="summary" class="text-xs uppercase tracking-widest text-slate-400 hover:text-cyan-300 relative overflow-hidden">Tactical & Logistics</summary>
                    <ul data-sidebar-module-target="content">
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_campaign_index') }}" class="{% if current_route == 'app_campaign_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/alien-structure-1.html.twig' with {'dim': '18'} %}
                                <span>Mission Logs</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_company_index') }}" class="{% if current_route == 'app_company_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/company.html.twig' with {'dim': '18'} %}
                                <span>Company Index</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            {% set is_asset_module = current_route starts with 'app_asset_' %}
                            <details {% if is_asset_module %}open{% endif %}>
                                <summary class="{% if is_asset_module %}text-cyan-400 font-bold{% endif %} text-xs uppercase tracking-widest">
                                    {% include 'icons/assets.html.twig' with {'dim': '18'} %}
                                    <span>Asset Manifest</span>
                                </summary>
                                <ul>
                                    <li>
                                        <a href="{{ path('app_asset_index') }}" class="{% if current_route == 'app_asset_index' and not app.request.query.get('view') %}text-cyan-400 font-bold{% endif %} capitalize tracking-widest pl-8">
                                            {% include 'icons/assets.html.twig' with {'dim': '18'} %}
                                            <span>All Assets</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{{ path('app_asset_index', {category: 'base', view: 'categorical'}) }}" class="{% if (app.request.query.get('category') == 'base' and app.request.query.get('view') == 'categorical') or (asset is defined and asset.category == 'base' and current_route == 'app_asset_edit') %}text-cyan-400 font-bold{% endif %} capitalize tracking-widest pl-8">
                                            {% include 'icons/spaceport.html.twig' with {'dim': '18'} %}
                                            <span>Base // Station</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{{ path('app_asset_index', {category: 'ship', view: 'categorical'}) }}" class="{% if (app.request.query.get('category') == 'ship' and app.request.query.get('view') == 'categorical') or (asset is defined and asset.category == 'ship' and current_route == 'app_asset_edit') %}text-cyan-400 font-bold{% endif %} capitalize tracking-widest pl-8">
                                            {% include 'icons/far-trader.html.twig' with {'dim': '18'} %}
                                            <span>Ship // Vessel</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{{ path('app_asset_index', {category: 'team', view: 'categorical'}) }}" class="{% if (app.request.query.get('category') == 'team' and app.request.query.get('view') == 'categorical') or (asset is defined and asset.category == 'team' and current_route == 'app_asset_edit') %}text-cyan-400 font-bold{% endif %} capitalize tracking-widest pl-8">
                                            {% include 'icons/team.html.twig' with {'dim': '18'} %}
                                            <span>Team // Unit</span>
                                        </a>
                                    </li>
                                </ul>
                            </details>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_crew_index') }}" class="{% if current_route == 'app_crew_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/crew.html.twig' with {'dim': '18'} %}
                                <span>Crew Registry</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_route_index') }}" class="{% if current_route == 'app_route_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/routes.html.twig' with {'dim': '18'} %}
                                <span>Navigation Routes</span>
                            </a>
                        </li>
                    </ul>
                </details>
            </li>
            <li>
                {% set manual_active = current_route starts with 'app_operation' %}
                <details {% if manual_active %}open{% endif %} data-controller="sidebar-module" data-action="toggle->sidebar-module#toggle">
                    <summary data-sidebar-module-target="summary" class="text-xs uppercase tracking-widest text-slate-400 hover:text-cyan-300 relative overflow-hidden">Manuals & Flows</summary>
                    <ul data-sidebar-module-target="content">
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_operation_guide') }}" class="{% if current_route == 'app_operation_guide' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/operations-checklist.html.twig' with {'dim': '18'} %}
                                <span>Ops Checklist</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_operations_flow') }}" class="{% if current_route == 'app_operations_flow' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/operations-flow.html.twig' with {'dim': '18'} %}
                                <span>Systems Flow</span>
                            </a>
                        </li>
                    </ul>
                </details>
            </li>

            {# FINANCE MODULE #}
            <li class="menu-title mt-6">
                <span class="text-xs uppercase tracking-[0.3em] text-cyan-500 font-bold opacity-80">Financial Core</span>
            </li>
            <li>
                {% set finance_active = current_route starts with 'app_income' 
                    or current_route starts with 'app_cost' 
                    or current_route starts with 'app_mortgage' 
                    or current_route starts with 'app_annual_budget' %}
                <details {% if finance_active %}open{% endif %} data-controller="sidebar-module" data-action="toggle->sidebar-module#toggle">
                    <summary data-sidebar-module-target="summary" class="text-xs uppercase tracking-widest text-slate-400 hover:text-cyan-300 relative overflow-hidden">Credits & Debt</summary>
                    <ul data-sidebar-module-target="content">
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_income_index') }}" class="{% if current_route == 'app_income_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/income.html.twig' with {'dim': '18'} %}
                                <span>Credits Ledger</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_cost_index') }}" class="{% if current_route == 'app_cost_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/cost.html.twig' with {'dim': '18'} %}
                                <span>Expense Logs</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_mortgage_index') }}" class="{% if current_route == 'app_mortgage_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/handbook.html.twig' with {'dim': '18'} %}
                                <span>Debt Manifest</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_annual_budget_index') }}" class="{% if current_route == 'app_annual_budget_index' %}text-cyan-400 font-bold{% endif %}">
                                {% include 'icons/annual-budget.html.twig' with {'dim': '18'} %}
                                <span>Annual Projections</span>
                            </a>
                        </li>
                        <li data-sidebar-module-target="item">
                            <a href="{{ path('app_financial_core_guide') }}" class="{% if current_route == 'app_financial_core_guide' %}text-cyan-400 font-bold{% endif %} border-t border-slate-700/50 mt-2 pt-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                </svg>
                                <span>Usage Guide</span>
                            </a>
                        </li>
                    </ul>
                </details>
            </li>


            {# SYSTEM LEVEL #}
            {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_ALLOWED_TO_SWITCH') %}
                <li class="menu-title mt-6">
                    <span class="text-xs uppercase tracking-[0.3em] text-red-500 font-bold opacity-80">Core Overwrite</span>
                </li>
                <li>
                    <a href="{{ path('admin') }}" class="hover:bg-red-500/10 hover:text-red-400 transition-all">
                        {% include 'icons/admin.html.twig' with {'dim': '20'} %}
                        <span>System Admin</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </div>
</div>
